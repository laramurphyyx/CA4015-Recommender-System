
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CA4015 - Assignment 3 &amp; 4</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-2 bd-sidebar site-navigation show single-page" id="site-navigation">
    
</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            
            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/laramurphyyx/CA4015-Recommender-System/tree/main/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/laramurphyyx/CA4015-Recommender-System/tree/main/jupyter-book/issues/new?title=Issue%20on%20page%20%2FPage 1 - Introduction.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#document-Page 2 - Data Exploration">
   Data Exploration
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#exploring-the-users-friends-dataset">
   Exploring the Users’ Friends Dataset
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#exploring-users-tagged-artists">
   Exploring Users’ Tagged Artists
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#exploring-the-artists-and-tags-dataset">
   Exploring the Artists and Tags Dataset
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#document-Page 3 - Adjusting User-Artist Weights">
   Adjusting User-Artist Weights
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#creating-a-loop-to-add-star-ratings-based-on-normal-distribution">
   Creating a Loop to add Star-Ratings based on Normal Distribution
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#document-Page 4 - Assigning Tags to Artists">
   Assigning Tags to Artists
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#document-Page 5 - Basic Recommender">
   Basic Recommender System
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#document-Page 6 - Content-Based Recommender">
   Content-Based Recommender System
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#using-the-top-5-instead-of-top-1-tags">
   Using the Top-5 Instead of Top-1 Tags
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#document-Page 7 - Collaborative Filtering Recommender">
   Collaborative Filtering Recommender System
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#inspect-embeddings">
   Inspect Embeddings
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#document-Page 8 - Using the Recommender Systems">
   Using the Recommender Systems
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#guideline-to-use-the-basic-recommender-system">
   Guideline to use the Basic Recommender System
  </a>
 </li>
 <li class="toctree-l1 toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="Page 1 - Introduction.html#guideline-to-use-the-content-based-recommender-system">
   Guideline to use the Content-Based Recommender System
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="background">
<h1>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-are-recommender-systems">
<h2>What are Recommender Systems?<a class="headerlink" href="#what-are-recommender-systems" title="Permalink to this headline">¶</a></h2>
<p>Recommender systems are machine-learning based algorithms that can ‘learn’ what a user might like to see, based on the information it has about the user or the product/item. Recommender systems can be seen in many services that we use regularly, such as Amazon recommending products to us or Facebook recommending people we may know. Some companies rely heavily on the use of these techniques and algorithms, such as Netflix, where their business model and its success are influenced by the accuracy of their recommendations.</p>
</div>
<div class="section" id="how-do-recommender-systems-work">
<h2>How do Recommender Systems Work?<a class="headerlink" href="#how-do-recommender-systems-work" title="Permalink to this headline">¶</a></h2>
<p>There are several approaches that can be taken to build a recommender system. Some of which are:</p>
<ul class="simple">
<li><p><b>Simple Recommenders</b>: These are the easiest to implement. This is a simple recommender system that shows the user what is popular. This is a generalised method of recommending, although the idea behind this system is that things that are more popular and more liked will be more likely to be enjoyed by the average audience.</p></li>
<li><p><b>Collaborative Filtering</b>: This method is more complex than the above Simple Recommender, as it is more specific to the user. This method ignores information about the target item (song, movie, etc.), and just bases its recommendation purely on user information/opinions. The concept of collaborative filtering is based on the idea that user A has the same likes/dislikes/opinions as user B, that user A is more likely to have the same opinion as user B on a different issue than a randomly chosen user. (<a class="reference external" href="https://www.datacamp.com/community/tutorials/recommender-systems-python">Interesting link about user-based vs. item-based</a>)</p></li>
<li><p><b>Content-Based Recommenders</b>: This approach uses the item’s metadata, for example the metadata held for a movie would be it’s genre, director, description or actors. This algorithm identifies the genres/directors/actors that a user generally likes, and uses this as a guide for future recommendations.</p></li>
<li><p><b>Hybrid Approach</b>: This approach is a combination of collaborative filtering and content-based recommenders. This can be quite difficult to implement, although when optimized, can outperform both methods of recommending.</p></li>
</ul>
</div>
<div class="section" id="about-the-data-used-in-our-recommender-system">
<h2>About the Data used in our Recommender System<a class="headerlink" href="#about-the-data-used-in-our-recommender-system" title="Permalink to this headline">¶</a></h2>
<p>Our Recommender System is based on artists from the LastFM dataset.
The LastFM dataset contains information about 92,800 artists and 1,892 users. The data is comprised of 6 files:</p>
<ul class="simple">
<li><p>artists.dat : This file contains information about the artist, such as their ID, their name, and URLs associated with them</p></li>
<li><p>tags.dat : This file contains a mapping for each tag ID and the tag description</p></li>
<li><p>user_artists.dat : This file contains information about how many times a user has listened to each artist</p></li>
<li><p>user_friends.dat : This file contains a mapping for a user and each of their friends</p></li>
<li><p>user_taggedartists.dat : This file contains information about the tags assigned to each artist from each user</p></li>
<li><p>user_taggedartists_timestamps.dat : This file contains the same content as user_taggedartists.dat, but with the added timestamp</p></li>
</ul>
<p>The dataset also includes a readme file to provide context and further explanation on the information contained in each file.</p>
<p>This dataset is available through <a class="reference external" href="https://grouplens.org/datasets/hetrec-2011/">this link</a>, or you can download it directly by clicking <a class="reference external" href="http://files.grouplens.org/datasets/hetrec2011/hetrec2011-lastfm-2k.zip">here</a>.</p>
</div>
<div class="toctree-wrapper compound">
<span id="document-Page 2 - Data Exploration"></span><div class="section" id="data-exploration">
<h2>Data Exploration<a class="headerlink" href="#data-exploration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="importing-relevant-packages-and-datasets">
<h3>Importing Relevant Packages and Datasets<a class="headerlink" href="#importing-relevant-packages-and-datasets" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataframe_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;user_friends&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user_taggedartists&#39;</span><span class="p">,</span>
    <span class="s1">&#39;artists&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tags&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user_artists&#39;</span><span class="p">]</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;../data/user_friends.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/user_taggedartists.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/artists.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/tags.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/user_artists.csv&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dataframe_names</span><span class="p">,</span> <span class="n">file_names</span><span class="p">):</span>
    <span class="nb">vars</span><span class="p">()[</span><span class="n">dataframe</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="exploring-the-users-friends-dataset">
<h2>Exploring the Users’ Friends Dataset<a class="headerlink" href="#exploring-the-users-friends-dataset" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">users_friends_count</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">user_friends</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;userID&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;friendID&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]})</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">users_friends_count</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">,</span> <span class="s1">&#39;count_friends&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">users_friends_count</span><span class="p">[</span><span class="s1">&#39;count_friends&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">min</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">users_friends_count</span><span class="p">[</span><span class="s1">&#39;count_friends&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">max</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">users_friends_count</span><span class="p">[</span><span class="s1">&#39;count_friends&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The average number of friends each user has is &#39;</span> <span class="o">+</span> <span class="n">mean</span> <span class="o">+</span> <span class="s1">&#39; friends&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The user with the least amount of friends has &#39;</span> <span class="o">+</span> <span class="nb">min</span> <span class="o">+</span> <span class="s1">&#39; friends&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The user with the most amount of friends has &#39;</span> <span class="o">+</span> <span class="nb">max</span> <span class="o">+</span> <span class="s1">&#39; friends&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The average number of friends each user has is 13.44291754756871 friends
The user with the least amount of friends has 1 friends
The user with the most amount of friends has 119 friends
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">users_friends_count</span><span class="p">[</span><span class="s1">&#39;count_friends&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Number of Friends per User&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Number of Friends&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 2 - Data Exploration_9_0.png" src="_images/Page 2 - Data Exploration_9_0.png" />
</div>
</div>
<p>As you can see in the above chart, over 60% of the users in this dataset have between 0 and 10 friends. Only ~15% of users have between 10 and 20 friends.</p>
<p>We can also conclude that only less than 25% of users have over 20 friends. This is useful to know, as this would imply that a recommender system based off a user’s friends’ favourite artists alone may not perform accurately.</p>
<p>Although using friends’ liked artists as a sole method to recommend songs will not perform well, it might be useful to put a slightly larger weight on their friends’ artists, as long as they have a similar taste in music.</p>
</div>
<div class="section" id="exploring-users-tagged-artists">
<h2>Exploring Users’ Tagged Artists<a class="headerlink" href="#exploring-users-tagged-artists" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tagged_artists_users</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">user_taggedartists</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;artistID&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;userID&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]})</span>
<span class="p">)</span>

<span class="n">tagged_artists_users</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">user_taggedartists</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;artistID&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;userID&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">nunique</span><span class="p">()})</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tagged_artists_users</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;artistID&#39;</span><span class="p">,</span> <span class="s1">&#39;count_users&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagged_artists_users</span><span class="p">[</span><span class="s1">&#39;count_users&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">min</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagged_artists_users</span><span class="p">[</span><span class="s1">&#39;count_users&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">max</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagged_artists_users</span><span class="p">[</span><span class="s1">&#39;count_users&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The average artist has been assigned a tag from &#39;</span> <span class="o">+</span> <span class="n">mean</span> <span class="o">+</span> <span class="s1">&#39; users&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The user with the least amount of of users assigning tags has &#39;</span> <span class="o">+</span> <span class="nb">min</span> <span class="o">+</span> <span class="s1">&#39; user(s)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The user with the most amount users assigning tags has &#39;</span> <span class="o">+</span> <span class="nb">max</span> <span class="o">+</span> <span class="s1">&#39; users&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The average artist has been assigned a tag from 5.7730559843991225 users
The user with the least amount of of users assigning tags has 1 user(s)
The user with the most amount users assigning tags has 206 users
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">tagged_artists_users</span><span class="p">[</span><span class="s1">&#39;count_users&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Number of Users assigning Tags per Artist&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Number of Users&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 2 - Data Exploration_15_0.png" src="_images/Page 2 - Data Exploration_15_0.png" />
</div>
</div>
<p>The plot above shows that there are very few artists that have over 50 users assigning tags.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tagged_artists_users</span><span class="p">[</span><span class="n">tagged_artists_users</span><span class="p">[</span><span class="s1">&#39;count_users&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>artistID       146
count_users    146
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>There are 55 artists who have been assigned tags from over 50 users. This suggests that there isn’t a mistaken outlier, and that the data is just very sparse (just over 1%) after reaching 50 users.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tagged_artists_tags</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">user_taggedartists</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;artistID&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;tagID&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">nunique</span><span class="p">()})</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tagged_artists_tags</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;artistID&#39;</span><span class="p">,</span> <span class="s1">&#39;count_tags&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagged_artists_tags</span><span class="p">[</span><span class="s1">&#39;count_tags&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">min</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagged_artists_tags</span><span class="p">[</span><span class="s1">&#39;count_tags&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">max</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagged_artists_tags</span><span class="p">[</span><span class="s1">&#39;count_tags&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The average artist has been assigned &#39;</span> <span class="o">+</span> <span class="n">mean</span> <span class="o">+</span> <span class="s1">&#39; tags&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The user with the least amount of tags has &#39;</span> <span class="o">+</span> <span class="nb">min</span> <span class="o">+</span> <span class="s1">&#39; tag(s)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The user with the most amount tags has &#39;</span> <span class="o">+</span> <span class="nb">max</span> <span class="o">+</span> <span class="s1">&#39; tags&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The average artist has been assigned 8.915576501178192 tags
The user with the least amount of tags has 1 tag(s)
The user with the most amount tags has 329 tags
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">tagged_artists_tags</span><span class="p">[</span><span class="s1">&#39;count_tags&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Number of Tags assigned to each Artist&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Number of Tags&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 2 - Data Exploration_22_0.png" src="_images/Page 2 - Data Exploration_22_0.png" />
</div>
</div>
<p>The above graph shows that over 25% of artists have received only 1 unique tag.</p>
<p>The frequency of tags seems to be very close to 0 when the number of tags is greater than 75.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tagged_artists_tags</span><span class="p">[</span><span class="n">tagged_artists_tags</span><span class="p">[</span><span class="s1">&#39;count_tags&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">75</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">tagged_artists_tags</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>artistID      0.9935
count_tags    0.9935
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tagged_artists_tags</span><span class="p">[</span><span class="n">tagged_artists_tags</span><span class="p">[</span><span class="s1">&#39;count_tags&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">tagged_artists_tags</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>artistID      0.537093
count_tags    0.537093
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Only 81 (0.65%) of the artists have greater than 75 unique tags assigned to them.</p>
<p>In fact, over half of the artists have been assigned between 1 and 5 unique tags.</p>
<p>These tags will allow for a more complex recommendation to be made to a user.</p>
</div>
<div class="section" id="exploring-the-artists-and-tags-dataset">
<h2>Exploring the Artists and Tags Dataset<a class="headerlink" href="#exploring-the-artists-and-tags-dataset" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>url</th>
      <th>pictureURL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>MALICE MIZER</td>
      <td>http://www.last.fm/music/MALICE+MIZER</td>
      <td>http://userserve-ak.last.fm/serve/252/10808.jpg</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Diary of Dreams</td>
      <td>http://www.last.fm/music/Diary+of+Dreams</td>
      <td>http://userserve-ak.last.fm/serve/252/3052066.jpg</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>Carpathian Forest</td>
      <td>http://www.last.fm/music/Carpathian+Forest</td>
      <td>http://userserve-ak.last.fm/serve/252/40222717...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>Moi dix Mois</td>
      <td>http://www.last.fm/music/Moi+dix+Mois</td>
      <td>http://userserve-ak.last.fm/serve/252/54697835...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Bella Morte</td>
      <td>http://www.last.fm/music/Bella+Morte</td>
      <td>http://userserve-ak.last.fm/serve/252/14789013...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tags</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tagID</th>
      <th>tagValue</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>metal</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>alternative metal</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>goth rock</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>black metal</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>death metal</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The artists and tags datasets are just a reference table to expand on the artist details or the tag details.</p>
<p>This does not require any more investigation, as there are no relevant data points to be used in our recommender system.</p>
<div class="section" id="exploring-users-liked-artists">
<h3>Exploring Users’ Liked Artists<a class="headerlink" href="#exploring-users-liked-artists" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution_of_weights_given</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">user_artists</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;userID&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]})</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution_of_weights_given</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;users_count&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">distribution_of_weights_given</span><span class="p">[</span><span class="s1">&#39;users_count&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Weights &#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Number of Users&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 2 - Data Exploration_34_0.png" src="_images/Page 2 - Data Exploration_34_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0        13883
1        11690
2        11351
3        10300
4         8983
         ...  
92829      337
92830      297
92831      281
92832      280
92833      263
Name: weight, Length: 92834, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_of_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">list_of_weights</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 2 - Data Exploration_37_0.png" src="_images/Page 2 - Data Exploration_37_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_of_weights</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>745.2439300256372
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">list_of_weights</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">300</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 2 - Data Exploration_39_0.png" src="_images/Page 2 - Data Exploration_39_0.png" />
</div>
</div>
<p>Let’s find out what proportion of people’s weights are under 10,000</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_artists</span><span class="p">[</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">10000</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">/</span><span class="mi">92834</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>userID      0.993214
artistID    0.993214
weight      0.993214
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>99.32% of people are under 10,000 listens</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_artists</span><span class="p">[</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">2328</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">/</span><span class="mi">92834</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>userID      0.950008
artistID    0.950008
weight      0.950008
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>95% of the users listen to artists under 2328 times</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">user_artists</span><span class="p">[</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">2328</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">30</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 2 - Data Exploration_45_0.png" src="_images/Page 2 - Data Exploration_45_0.png" />
</div>
</div>
</div>
</div>
<span id="document-Page 3 - Adjusting User-Artist Weights"></span><div class="section" id="adjusting-user-artist-weights">
<h2>Adjusting User-Artist Weights<a class="headerlink" href="#adjusting-user-artist-weights" title="Permalink to this headline">¶</a></h2>
<div class="section" id="importing-relevant-packages-and-datasets">
<h3>Importing Relevant Packages and Datasets<a class="headerlink" href="#importing-relevant-packages-and-datasets" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">functions</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataframe_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;user_friends&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user_taggedartists&#39;</span><span class="p">,</span>
    <span class="s1">&#39;artists&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tags&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user_artists&#39;</span><span class="p">]</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;../data/user_friends.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/user_taggedartists.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/artists.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/tags.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/user_artists.csv&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dataframe_names</span><span class="p">,</span> <span class="n">file_names</span><span class="p">):</span>
    <span class="nb">vars</span><span class="p">()[</span><span class="n">dataframe</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exploring-the-data">
<h3>Exploring the data<a class="headerlink" href="#exploring-the-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">300</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_6_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_6_0.png" />
</div>
</div>
<p>It is difficult to visualise the distribution of the weights using this graph. It is likely that there are few datapoints that go beyond 35,000 and this is causing the rest of the data to be very small and difficult to interpret.</p>
<p>By running some basic commands, I have discovered that 95% of weights are less than or equal to 2,328.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">user_artists</span><span class="p">[</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">2328</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Weights&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_8_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_8_0.png" />
</div>
</div>
<p>This is the new plot where we have excluded any weights over 2,328.</p>
<p>The graph is much easier to interpret and seems to follow a gamma/exponential distribution.</p>
</div>
<div class="section" id="different-options">
<h3>Different options<a class="headerlink" href="#different-options" title="Permalink to this headline">¶</a></h3>
<p>At the moment, it would be quite difficult to seperate the data as it does not follow a normal distribution.</p>
<p>There are different methods we can try to assign a rating for each weight.</p>
<div class="section" id="option-1">
<h4>Option 1<a class="headerlink" href="#option-1" title="Permalink to this headline">¶</a></h4>
<p>Since the distribution of weights has a very long tail, we can find a point where most of the tail is where users gave artists a 5-star rating, and then divide the rest of the weights intuitively/mathematically into 1-4 stars.
This would be to assume a 25% split between 1-star, 2-star, 3-star and 4-star ratings (after we have identified the cut-off poiint for 5-star ratings).</p>
<p>The drawbacks of this option:</p>
<ul class="simple">
<li><p>It is not user specific, the percentages (25%) will be the same for all users, except the 5-star rating, which may be disproportionately distributed if someone listens to a huge amount of music.</p></li>
<li><p>It is not accurately representative of natural distribution you’d expect from users liking artists. It is more likely to follow a slight normal distribution where there are more 3 star ratings than 1 or 5 star ratings.</p></li>
</ul>
</div>
<div class="section" id="option-2">
<h4>Option 2<a class="headerlink" href="#option-2" title="Permalink to this headline">¶</a></h4>
<p>Use a user’s average weighting and do a normal distribution seperator.</p>
<ol class="simple">
<li><p>Do a case study on 10 random people to see the distribution of their weights</p></li>
<li><p>If the distribution is normal, follow the standard procedure to separate the ratings, if the distribution is not normal, try to identify if the distribution could be separated in a different way.</p></li>
</ol>
<p>The drawbacks of this option:</p>
<ul class="simple">
<li><p>It is unlikely that the users’ specific weight distribution is normal as the weight distribution as a whole is extremly long-tailed.</p></li>
<li><p>If we are working with a long-tailed distribution, the method to assign ratings will have to be manually decided and might not be optimal.</p></li>
</ul>
<p><u>Option 2</u> seems like it will yield better results.</p>
<p>We’ll firstly investigate the distribution of all users’ average weights and then look at 5 users and view their weight distributions in isolation.</p>
</div>
</div>
<div class="section" id="investigating-users-average-weight">
<h3>Investigating Users’ Average Weight<a class="headerlink" href="#investigating-users-average-weight" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution_of_weights_given</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">user_artists</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;userID&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]})</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution_of_weights_given</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;users_avg&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">distribution_of_weights_given</span><span class="p">[</span><span class="s1">&#39;users_avg&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Average Weights &#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Average Weight&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_15_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_15_0.png" />
</div>
</div>
<p>This graph shows quite a clear normal distribution, this may be useful to us depending on the specific user distributions.</p>
</div>
<div class="section" id="investigating-5-users-distributions">
<h3>Investigating 5 Users’ Distributions<a class="headerlink" href="#investigating-5-users-distributions" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">user_artists</span><span class="p">[</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Weights for User #0&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Weight Values&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_18_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_18_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">user_artists</span><span class="p">[</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">42</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Weights for User #4&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Weight Values&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_19_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_19_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">user_artists</span><span class="p">[</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Weights for User #5&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Weight Values&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_20_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_20_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">user_artists</span><span class="p">[</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">652</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Weights for User #652&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Weight Values&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_21_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_21_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">user_artists</span><span class="p">[</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1891</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Weights for User #1891&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Weight Values&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_22_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_22_0.png" />
</div>
</div>
<p>All of the above figures, for users #0, #4, #5, #652, #1891, have a long-tailed distribution.</p>
<p>This makes the distribution of ratings slightly more tricky.</p>
<p>Let’s investigate for some of these users, how they would be processed if treated like a normal distribution.</p>
<p><a id=’plotting_mean_std’></a></p>
</div>
<div class="section" id="plotting-the-mean-and-standard-deviation-on-users-weight-distribution">
<h3>Plotting the Mean and Standard Deviation on Users’ Weight Distribution<a class="headerlink" href="#plotting-the-mean-and-standard-deviation-on-users-weight-distribution" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_weights_mean_and_std</span><span class="p">(</span><span class="n">user_artists</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_25_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_25_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_weights_mean_and_std</span><span class="p">(</span><span class="n">user_artists</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_26_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_26_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_weights_mean_and_std</span><span class="p">(</span><span class="n">user_artists</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_27_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_27_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_weights_mean_and_std</span><span class="p">(</span><span class="n">user_artists</span><span class="p">,</span> <span class="mi">652</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_28_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_28_0.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_weights_mean_and_std</span><span class="p">(</span><span class="n">user_artists</span><span class="p">,</span> <span class="mi">1891</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_29_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_29_0.png" />
</div>
</div>
<p>These five graphs show us that using the mean and standard deviation as a method to assign our-star ratings, it would have some key performance issues.</p>
<p>This method does not prove very efficient as there are no occurrences of a 1-star rating for all users examined. It also does not apply to users who have outlier-like values, such as user #5 having one occurence of a weight above 40,000 which increases the standard deviation substantially, and results in majority of their weights belonging to the 3-star rating zone.</p>
<p>This issue with user #5 could be solved with outlier exclusion. Excluding outliers will reduce the size of the standard deviation, allowing the assignment of ratings to be more spread out, which may solve the issue of 1-star ratings also.</p>
</div>
<div class="section" id="removing-outliers-for-user-5">
<h3>Removing Outliers for User #5<a class="headerlink" href="#removing-outliers-for-user-5" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user5</span> <span class="o">=</span> <span class="n">remove_users_outliers</span><span class="p">(</span><span class="n">user_artists</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">user5_mean</span> <span class="o">=</span> <span class="n">user5</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">user5_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">user5</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_weights_mean_and_std</span><span class="p">(</span><span class="n">user5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_33_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_33_0.png" />
</div>
</div>
<p>The above graph shows slight improvement in comparison to the original graph contained in <a class="reference external" href="#plotting_mean_std">this section</a> where the means and standard deviations were graphed.</p>
<p>Using the adjusted data, the datapoint above 1,000 could be considered a datapoint, and we can iterate through the outlier exclusion process again. We can explore this later.</p>
<p>Since there is only a sample set of 5 users, they may not be representative of the group of users. Let’s assign the user ratings according to the normal distribution (mean and standard deviation), and see what adjustments can be made post-hoc.</p>
</div>
</div>
<div class="section" id="creating-a-loop-to-add-star-ratings-based-on-normal-distribution">
<h2>Creating a Loop to add Star-Ratings based on Normal Distribution<a class="headerlink" href="#creating-a-loop-to-add-star-ratings-based-on-normal-distribution" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">means_and_stds</span> <span class="o">=</span> <span class="n">find_means_and_stds_per_user</span><span class="p">(</span><span class="n">user_artists</span><span class="p">)</span>
<span class="n">means</span> <span class="o">=</span> <span class="n">means_and_stds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">stds</span> <span class="o">=</span> <span class="n">means_and_stds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_mean</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">means</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_std</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">stds</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_rating</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_40_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_40_0.png" />
</div>
</div>
<p>There are no artists that recieved a 1-star rating, this is due to the fact that the users’ weights are not normally distributed, they’re long-tailed distributions.</p>
<p>This causes the standard deviation to be larger, meaning that most of the weights to the left of the mean will be within 1 standard deviation of the mean, resulting in no 1-star ratings.</p>
<p>We can check now if removing the outliers will make a difference to the distribution of star ratings.</p>
<div class="section" id="adjusting-star-ratings-to-allow-for-outlier-exclusion">
<h3>Adjusting Star-Ratings to Allow for Outlier Exclusion<a class="headerlink" href="#adjusting-star-ratings-to-allow-for-outlier-exclusion" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Removing any weight that is above 2 standard deviations away from the mean</span>
<span class="n">adjusted_user_artists</span> <span class="o">=</span> <span class="n">user_artists</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">])</span><span class="o">&lt;</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">])]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Dropping and recreating the mean, standard deviation and rating columns</span>
<span class="n">adjusted_user_artists</span> <span class="o">=</span> <span class="n">adjusted_user_artists</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;rating&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">means_and_stds</span> <span class="o">=</span> <span class="n">find_means_and_stds_per_user</span><span class="p">(</span><span class="n">adjusted_user_artists</span><span class="p">)</span>
<span class="n">means</span> <span class="o">=</span> <span class="n">means_and_stds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">stds</span> <span class="o">=</span> <span class="n">means_and_stds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Recalculate the means, standard deviations and ratings</span>

<span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adjusted_user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_mean</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">means</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adjusted_user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_std</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">stds</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adjusted_user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_rating</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_47_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_47_0.png" />
</div>
</div>
<p>The adjustment didn’t have a huge effect on the final allocation of ratings, there are still a large number of weights on the tail of the distribution that are skewing the ratings.</p>
<p>A next possible option would be to filter the data where weights are below 2328, as we found that this exludes the top 5% of values that could be skewing the data.</p>
</div>
<div class="section" id="adding-star-ratings-excluding-the-top-5-of-weights">
<h3>Adding Star Ratings Excluding the Top 5% of Weights<a class="headerlink" href="#adding-star-ratings-excluding-the-top-5-of-weights" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adjusted_user_artists</span> <span class="o">=</span> <span class="n">user_artists</span><span class="p">[</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">2328</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Dropping and recreating the mean, standard deviation and rating columns</span>
<span class="n">adjusted_user_artists</span> <span class="o">=</span> <span class="n">adjusted_user_artists</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;rating&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Finding the new means and standard deviations</span>
<span class="n">means_and_stds</span> <span class="o">=</span> <span class="n">find_means_and_stds_per_user</span><span class="p">(</span><span class="n">adjusted_user_artists</span><span class="p">)</span>
<span class="n">means</span> <span class="o">=</span> <span class="n">means_and_stds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">stds</span> <span class="o">=</span> <span class="n">means_and_stds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Recalculate the means, standard deviations and ratings</span>
<span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adjusted_user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_mean</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">means</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adjusted_user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_std</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">stds</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adjusted_user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_rating</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">adjusted_user_artists</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_55_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_55_0.png" />
</div>
</div>
<p>Still have the same issue, let’s investigate what proportion of users’ weights are less than their mean.</p>
</div>
<div class="section" id="investigating-proportion-of-weights-below-mean">
<h3>Investigating Proportion of Weights below Mean<a class="headerlink" href="#investigating-proportion-of-weights-below-mean" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Finding the new means and standard deviations</span>
<span class="n">means_and_stds</span> <span class="o">=</span> <span class="n">find_means_and_stds_per_user</span><span class="p">(</span><span class="n">adjusted_user_artists</span><span class="p">)</span>
<span class="n">means</span> <span class="o">=</span> <span class="n">means_and_stds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">stds</span> <span class="o">=</span> <span class="n">means_and_stds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">below_mean</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">userID</span> <span class="ow">in</span> <span class="n">adjusted_user_artists</span><span class="o">.</span><span class="n">userID</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">below_means_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="n">user_artists</span><span class="p">[</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">userID</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;=</span> <span class="n">means</span><span class="p">[</span><span class="n">userID</span><span class="p">]:</span>
            <span class="n">below_means_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">below_mean</span><span class="p">[</span><span class="n">userID</span><span class="p">]</span> <span class="o">=</span> <span class="n">below_means_count</span><span class="o">/</span><span class="n">total</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">below_mean</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Weights below Mean&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_60_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_60_0.png" />
</div>
</div>
<p>Judging by this graph, almost all of the users have most of their weights lower than their mean, meaning that there are few very large weights that are causing this increase in the mean.</p>
</div>
<div class="section" id="final-decision">
<h3>Final Decision<a class="headerlink" href="#final-decision" title="Permalink to this headline">¶</a></h3>
<p>There is no one-size-fits-all for each user, as each user’s listening habits are different.</p>
<p>The standard deviation cannot be used as the values to the left of the mean are distributed differently to the values on the right side of the mean, so we should introduce a split at the mean.</p>
<ol class="simple">
<li><p>Find the mean</p></li>
<li><p>Find the minimum, and find the range of weights between the minimum and the mean.</p></li>
<li><p>Adjust the ratings so this range is divided into 25%, 50%, 25% for 1-star, 2-star and 3-star ratings respectively.</p></li>
<li><p>Find the maximum (up to a limit), and find the range of weights between the mean and the maximum.</p></li>
<li><p>Adjust the ratings so this range is divided into 25%, 50%, 25% for 3-star, 4-star and 5-star ratings respectively.</p></li>
</ol>
<p>The weights will not be distributed evenly, the percentages will be calculated as minimum + ((mean - min) * 0.25) for the 1-star ratings, for example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_artists</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Creating a dictionary to discover each users mean and standard deviation</span>
<span class="n">means</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">mins</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">maxs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">userID</span> <span class="ow">in</span> <span class="n">user_artists</span><span class="o">.</span><span class="n">userID</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="n">user_artists</span><span class="p">[</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">userID</span><span class="p">]</span>
    <span class="n">user_mean</span> <span class="o">=</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">user_min</span> <span class="o">=</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">user_max</span> <span class="o">=</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">means</span><span class="p">[</span><span class="n">userID</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_mean</span>
    <span class="n">mins</span><span class="p">[</span><span class="n">userID</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_min</span>
    <span class="n">maxs</span><span class="p">[</span><span class="n">userID</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_max</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_mean</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">]]</span>

<span class="k">def</span> <span class="nf">find_min</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">]]</span>

<span class="k">def</span> <span class="nf">find_max</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_mean</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">means</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_min</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">mins</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_max</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">maxs</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_rating</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span>
    <span class="n">user_mean</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
    <span class="n">user_min</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span>
    <span class="n">user_max</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span>
    <span class="c1">## Adjusting the max to 3000 to preserve distribution</span>
    <span class="k">if</span> <span class="n">user_max</span> <span class="o">&gt;</span> <span class="mi">3000</span><span class="p">:</span>
        <span class="n">user_max</span> <span class="o">=</span> <span class="mi">3000</span>
    <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">user_min</span> <span class="o">+</span> <span class="p">((</span><span class="n">user_mean</span> <span class="o">-</span> <span class="n">user_min</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">)):</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">weight</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">user_min</span> <span class="o">+</span> <span class="p">((</span><span class="n">user_mean</span> <span class="o">-</span> <span class="n">user_min</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">)):</span>
        <span class="k">return</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">weight</span> <span class="o">&lt;=</span> <span class="n">user_max</span> <span class="o">-</span> <span class="p">((</span><span class="n">user_max</span> <span class="o">-</span> <span class="n">user_mean</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">weight</span> <span class="o">&lt;=</span> <span class="n">user_max</span> <span class="o">-</span> <span class="p">((</span><span class="n">user_max</span> <span class="o">-</span> <span class="n">user_mean</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">4</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_artists</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">find_rating</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">user_artists</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Star Ratings&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 3 - Adjusting User-Artist Weights_70_0.png" src="_images/Page 3 - Adjusting User-Artist Weights_70_0.png" />
</div>
</div>
<p>This method seems to have an accurate representation of ratings, it is easier to listen to several artists just once and skip them than it is to listen to several artists thousands of times each.</p>
<p>We need to use these ratings for our recommender system, so we will remove unnecessary columns from the dataframe and export it as a CSV file into our data directory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_artists</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_artists</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userID</th>
      <th>artistID</th>
      <th>weight</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>45</td>
      <td>13883</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>46</td>
      <td>11690</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>47</td>
      <td>11351</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>48</td>
      <td>10300</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>49</td>
      <td>8983</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>92829</th>
      <td>1891</td>
      <td>17615</td>
      <td>337</td>
      <td>2</td>
    </tr>
    <tr>
      <th>92830</th>
      <td>1891</td>
      <td>17616</td>
      <td>297</td>
      <td>1</td>
    </tr>
    <tr>
      <th>92831</th>
      <td>1891</td>
      <td>17617</td>
      <td>281</td>
      <td>1</td>
    </tr>
    <tr>
      <th>92832</th>
      <td>1891</td>
      <td>17618</td>
      <td>280</td>
      <td>1</td>
    </tr>
    <tr>
      <th>92833</th>
      <td>1891</td>
      <td>17619</td>
      <td>263</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>92834 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_artists</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../data/user_artists_ratings.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-Page 4 - Assigning Tags to Artists"></span><div class="section" id="assigning-tags-to-artists">
<h2>Assigning Tags to Artists<a class="headerlink" href="#assigning-tags-to-artists" title="Permalink to this headline">¶</a></h2>
<div class="section" id="importing-relevant-packages-and-datasets">
<h3>Importing Relevant Packages and Datasets<a class="headerlink" href="#importing-relevant-packages-and-datasets" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">heapq</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/artists.csv&#39;</span><span class="p">)</span>
<span class="n">user_taggedartists</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/user_taggedartists.csv&#39;</span><span class="p">)</span>
<span class="n">tags</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/tags.csv&#39;</span><span class="p">)</span>
<span class="n">user_artists_ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/user_artists_ratings.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="finding-the-top-2-tags-per-artist">
<h3>Finding the top 2 tags per artist<a class="headerlink" href="#finding-the-top-2-tags-per-artist" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists</span><span class="p">[</span><span class="s1">&#39;first_tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">artists</span><span class="p">[</span><span class="s1">&#39;second_tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">user_taggedartists</span><span class="o">.</span><span class="n">artistID</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">artist_data</span> <span class="o">=</span> <span class="n">user_taggedartists</span><span class="p">[</span><span class="n">user_taggedartists</span><span class="p">[</span><span class="s1">&#39;artistID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">artist</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">artist_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">first_tag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">second_tag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">top_two_tags</span> <span class="o">=</span> <span class="n">artist_data</span><span class="p">[</span><span class="s1">&#39;tagID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">first_tag</span> <span class="o">=</span> <span class="n">top_two_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_two_tags</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">second_tag</span> <span class="o">=</span> <span class="n">top_two_tags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">second_tag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">artists</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">artists</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">artist</span><span class="p">,</span> <span class="s1">&#39;first_tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">first_tag</span>
    <span class="n">artists</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">artists</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">artist</span><span class="p">,</span> <span class="s1">&#39;second_tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">second_tag</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="adding-a-column-for-the-top-5-tags-string-values">
<h3>Adding a Column for the Top 5 Tags (String Values)<a class="headerlink" href="#adding-a-column-for-the-top-5-tags-string-values" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tag_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">tag_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tags</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="n">tagID</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">tag_dict</span><span class="p">[</span><span class="n">tagID</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists</span><span class="p">[</span><span class="s1">&#39;top_five_tags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">user_taggedartists</span><span class="o">.</span><span class="n">artistID</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">artist_data</span> <span class="o">=</span> <span class="n">user_taggedartists</span><span class="p">[</span><span class="n">user_taggedartists</span><span class="p">[</span><span class="s1">&#39;artistID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">artist</span><span class="p">]</span>
    <span class="n">top_five_tags</span> <span class="o">=</span> <span class="n">artist_data</span><span class="p">[</span><span class="s1">&#39;tagID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="n">string_tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag_dict</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">top_five_tags</span><span class="p">]</span>
    
    <span class="n">top_5_string</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">string_tags</span><span class="p">)</span>
    <span class="n">artists</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">artists</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">artist</span><span class="p">,</span> <span class="s1">&#39;top_five_tags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_5_string</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exporting-the-csv-file">
<h3>Exporting the CSV File<a class="headerlink" href="#exporting-the-csv-file" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../data/artists_tags.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-Page 5 - Basic Recommender"></span><div class="section" id="basic-recommender-system">
<h2>Basic Recommender System<a class="headerlink" href="#basic-recommender-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="importing-relevant-packages-and-datasets">
<h3>Importing Relevant Packages and Datasets<a class="headerlink" href="#importing-relevant-packages-and-datasets" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataframe_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;user_friends&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user_taggedartists&#39;</span><span class="p">,</span>
    <span class="s1">&#39;artists&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tags&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user_artists&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user_artists_ratings&#39;</span><span class="p">]</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;../data/user_friends.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/user_taggedartists.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/artists.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/tags.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/user_artists.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/user_artists_ratings.csv&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dataframe_names</span><span class="p">,</span> <span class="n">file_names</span><span class="p">):</span>
    <span class="nb">vars</span><span class="p">()[</span><span class="n">dataframe</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recommender-system-outline">
<h3>Recommender System Outline<a class="headerlink" href="#recommender-system-outline" title="Permalink to this headline">¶</a></h3>
<p>For the basic recommender system, this will not take in any personalisation - it will be the same recommendations for all users.</p>
<p>This recommender system only recommends artists that have high ratings.</p>
<p>We will use the artists’ average ratings, but this could be skewed by an artist who has very few ratings that yield a high average. To prevent this, we will take the top 10% of artists that have the highest number of user ratings, and then filter to find the artists with the highest average rating.</p>
<ol class="simple">
<li><p>Make one for most popular all time</p></li>
<li><p>Make one for trending and use the timestamps one - maybe per genre?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists_users_ratings</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">user_artists_ratings</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;artistID&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;userID&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> <span class="s1">&#39;rating&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]})</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists_users_ratings</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;artistID&#39;</span><span class="p">,</span> <span class="s1">&#39;count_users&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_rating&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">artists_users_ratings</span><span class="p">[</span><span class="s1">&#39;count_users&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Users&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Number of Users&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 5 - Basic Recommender_9_0.png" src="_images/Page 5 - Basic Recommender_9_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">artists_users_ratings</span><span class="p">[</span><span class="s1">&#39;avg_rating&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Average Rating&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Average Rating&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 5 - Basic Recommender_10_0.png" src="_images/Page 5 - Basic Recommender_10_0.png" />
</div>
</div>
<p>It’s clear from the first graph that almost all of the artists in the dataset have less than 100 users listening to them. We can also see that the average rating received by artists has a negative linear relationship. This will make sense as users are shown lots of artists but may only listen to a small amount more regularly.</p>
</div>
<div class="section" id="recommending-the-top-5-artists-that-you-might-like">
<h3>Recommending the Top 5 Artists that You Might Like<a class="headerlink" href="#recommending-the-top-5-artists-that-you-might-like" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Finding the top 10% of artists</span>
<span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">artists_users_ratings</span><span class="p">[</span><span class="s1">&#39;count_users&#39;</span><span class="p">],</span> <span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">artists_users_ratings</span><span class="p">[</span><span class="n">artists_users_ratings</span><span class="p">[</span><span class="s1">&#39;count_users&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;count_users&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">artists_users_ratings</span><span class="p">[</span><span class="s1">&#39;count_users&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.605660163339383
</pre></div>
</div>
</div>
</div>
<p>Over 60% of artists have only had one user listen to their music.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">most_listened_to_artists</span> <span class="o">=</span> <span class="n">artists_users_ratings</span><span class="p">[</span><span class="n">artists_users_ratings</span><span class="p">[</span><span class="s1">&#39;count_users&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">8</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">most_listened_to_artists</span><span class="p">[</span><span class="s1">&#39;avg_rating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.5
</pre></div>
</div>
</div>
</div>
<p>Since the highest average rating for the top 10% of artists is only 3.5, we can either increase the amount of artists being considered (increase to the top 20% of artists), or we can identify the amount of times the artists is listened to per user.</p>
</div>
<div class="section" id="identifying-total-listens-per-user">
<h3>Identifying Total Listens per User<a class="headerlink" href="#identifying-total-listens-per-user" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists_total_listens</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">user_artists_ratings</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;artistID&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;userID&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> <span class="s1">&#39;rating&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">]})</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists_total_listens</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;artistID&#39;</span><span class="p">,</span> <span class="s1">&#39;count_users&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_rating&#39;</span><span class="p">,</span> <span class="s1">&#39;total_listens&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">artists_total_listens</span><span class="p">[</span><span class="s1">&#39;total_listens&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Total Listens&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Number of Listens&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 5 - Basic Recommender_22_0.png" src="_images/Page 5 - Basic Recommender_22_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Finding the top 10% of artists</span>
<span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">artists_total_listens</span><span class="p">[</span><span class="s1">&#39;total_listens&#39;</span><span class="p">],</span> <span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4645.399999999998
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists_highest_total_listens</span> <span class="o">=</span> <span class="n">artists_total_listens</span><span class="p">[</span><span class="n">artists_total_listens</span><span class="p">[</span><span class="s1">&#39;total_listens&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">4645</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">artists_highest_total_listens</span><span class="p">[</span><span class="s1">&#39;avg_rating&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Distribution of Average Ratings for the top 10</span><span class="si">% Li</span><span class="s1">stened-To Artists&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Number of Listens&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 5 - Basic Recommender_25_0.png" src="_images/Page 5 - Basic Recommender_25_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists_highest_listens</span> <span class="o">=</span> <span class="n">artists_highest_total_listens</span><span class="p">[</span><span class="n">artists_highest_total_listens</span><span class="p">[</span><span class="s1">&#39;count_users&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>By filtering this dataset to only artists that have a user count above 5, removed artists that have one/two user(s) who have listened a very large number of times and have given 5-star ratings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">artists_highest_listens</span><span class="p">[</span><span class="s1">&#39;avg_rating&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Page 5 - Basic Recommender_28_0.png" src="_images/Page 5 - Basic Recommender_28_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recommendations</span> <span class="o">=</span> <span class="n">artists_highest_listens</span><span class="p">[</span><span class="s1">&#39;avg_rating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recommendations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10886    4.200000
2285     3.833333
Name: avg_rating, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists_ordered_popularity</span> <span class="o">=</span> <span class="n">artists_highest_listens</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;avg_rating&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artist1_rec</span> <span class="o">=</span> <span class="n">artists_ordered_popularity</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,][</span><span class="s1">&#39;artistID&#39;</span><span class="p">]</span>
<span class="n">artist2_rec</span> <span class="o">=</span> <span class="n">artists_ordered_popularity</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,][</span><span class="s1">&#39;artistID&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artist1_details</span> <span class="o">=</span> <span class="n">artists</span><span class="p">[</span><span class="n">artists</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">artist1_rec</span><span class="p">]</span>
<span class="n">artist1_name</span> <span class="o">=</span> <span class="n">artist1_details</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">artist1_link</span> <span class="o">=</span> <span class="n">artist1_details</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artist2_details</span> <span class="o">=</span> <span class="n">artists</span><span class="p">[</span><span class="n">artists</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">artist2_rec</span><span class="p">]</span>
<span class="n">artist2_name</span> <span class="o">=</span> <span class="n">artist2_details</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">artist2_link</span> <span class="o">=</span> <span class="n">artist2_details</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artist2_link</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;http://www.last.fm/music/Ezginin+G%C3%BCnl%C3%BC%C4%9F%C3%BC&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We think you might like &quot;</span> <span class="o">+</span> <span class="n">artist1_name</span> <span class="o">+</span> <span class="s2">&quot;, and you can view their profile through this link: &quot;</span> <span class="o">+</span> <span class="n">artist1_link</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We think you might like Bernard Butler, and you can view their profile through this link: http://www.last.fm/music/Bernard+Butler
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You might also like &quot;</span> <span class="o">+</span> <span class="n">artist2_name</span> <span class="o">+</span> <span class="s2">&quot;, and you can view their profile through this link: &quot;</span> <span class="o">+</span> <span class="n">artist2_link</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>You might also like Ezginin Günlüğü, and you can view their profile through this link: http://www.last.fm/music/Ezginin+G%C3%BCnl%C3%BC%C4%9F%C3%BC
</pre></div>
</div>
</div>
</div>
<p>It might also be interesting to allow the user to decide what percentage of artists they want to see</p>
<p>Let’s see the results for if we wanted 50% of the artists included.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Finding the top 10% of artists</span>
<span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">artists_users_ratings</span><span class="p">[</span><span class="s1">&#39;count_users&#39;</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-Page 6 - Content-Based Recommender"></span><div class="section" id="content-based-recommender-system">
<h2>Content-Based Recommender System<a class="headerlink" href="#content-based-recommender-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="importing-relevant-packages-and-datasets">
<h3>Importing Relevant Packages and Datasets<a class="headerlink" href="#importing-relevant-packages-and-datasets" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">linear_kernel</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">cosine_similarity</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataframe_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;user_friends&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user_taggedartists&#39;</span><span class="p">,</span>
    <span class="s1">&#39;artists&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tags&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user_artists&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user_artists_ratings&#39;</span><span class="p">,</span>
    <span class="s1">&#39;artists_tags&#39;</span><span class="p">]</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;../data/user_friends.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/user_taggedartists.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/artists.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/tags.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/user_artists.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/user_artists_ratings.csv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../data/artists_tags.csv&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dataframe_names</span><span class="p">,</span> <span class="n">file_names</span><span class="p">):</span>
    <span class="nb">vars</span><span class="p">()[</span><span class="n">dataframe</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="adjusting-existing-columns">
<h3>Adjusting Existing Columns<a class="headerlink" href="#adjusting-existing-columns" title="Permalink to this headline">¶</a></h3>
<p>Importing artists that have their top two tags and converting them to their string equivalents</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tag_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">tag_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tags</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="n">tagID</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">tag_dict</span><span class="p">[</span><span class="n">tagID</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;first_tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">artists_tags</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">tag_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;first_tag&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;second_tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">artists_tags</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">tag_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;second_tag&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recommender-based-on-top-tag">
<h3>Recommender Based on Top Tag<a class="headerlink" href="#recommender-based-on-top-tag" title="Permalink to this headline">¶</a></h3>
<p>We aim to calculate the Term Frequency-Inverse Document Frequency (TF-IDF) for each artist. The terms will be taken from the assigned tags for each artist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tfidf</span> <span class="o">=</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">stop_words</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
<span class="n">tfidf_matrix</span> <span class="o">=</span> <span class="n">tfidf</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;first_tag&#39;</span><span class="p">])</span>
<span class="n">tfidf_matrix</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(17632, 1246)
</pre></div>
</div>
</div>
</div>
<p>This ‘tfidf’ object was created to remove any stop words that may appear in the user-assigned tags for each artist.</p>
<p>This was then fitted as a matrix with the dimensions (N x M) where N is the number of artists and M is the number of tokens/words (excluding stop words) that appear in their top tag. In this case, there are 17,632 artists and 1,246 words.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tfidf</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()[</span><span class="mi">900</span><span class="p">:</span><span class="mi">910</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;play&#39;,
 &#39;pleasure&#39;,
 &#39;pleasuredome&#39;,
 &#39;pleasures&#39;,
 &#39;podcast&#39;,
 &#39;poetry&#39;,
 &#39;polecane&#39;,
 &#39;polish&#39;,
 &#39;political&#39;,
 &#39;pop&#39;]
</pre></div>
</div>
</div>
</div>
<p>This is an example of some of the tokens that appear in the top five tags of each artist.</p>
<p>There are some tags that wouldn’t be classified as genres, such as ‘pleasures’ or ‘play’, although these are unlikely to affect the performance of the recommender system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cosine_sim</span> <span class="o">=</span> <span class="n">linear_kernel</span><span class="p">(</span><span class="n">tfidf_matrix</span><span class="p">,</span> <span class="n">tfidf_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">MemoryError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_30472</span><span class="o">/</span><span class="mf">2808778117.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">cosine_sim</span> <span class="o">=</span> <span class="n">linear_kernel</span><span class="p">(</span><span class="n">tfidf_matrix</span><span class="p">,</span> <span class="n">tfidf_matrix</span><span class="p">)</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\sklearn\metrics\pairwise.py</span> in <span class="ni">linear_kernel</span><span class="nt">(X, Y, dense_output)</span>
<span class="g g-Whitespace">   </span><span class="mi">1003</span>     <span class="s2">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1004</span><span class="s2">     X, Y = check_pairwise_arrays(X, Y)</span>
<span class="ne">-&gt; </span><span class="mi">1005</span><span class="s2">     return safe_sparse_dot(X, Y.T, dense_output=dense_output)</span>
<span class="g g-Whitespace">   </span><span class="mi">1006</span><span class="s2"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1007</span><span class="s2"> </span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\sklearn\utils\validation.py</span> in <span class="ni">inner_f</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span><span class="s2">             extra_args = len(args) - len(all_args)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span><span class="s2">             if extra_args &lt;= 0:</span>
<span class="ne">---&gt; </span><span class="mi">63</span><span class="s2">                 return f(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span><span class="s2"> </span>
<span class="g g-Whitespace">     </span><span class="mi">65</span><span class="s2">             # extra_args &gt; 0</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\sklearn\utils\extmath.py</span> in <span class="ni">safe_sparse_dot</span><span class="nt">(a, b, dense_output)</span>
<span class="g g-Whitespace">    </span><span class="mi">154</span><span class="s2">     if (sparse.issparse(a) and sparse.issparse(b)</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span><span class="s2">             and dense_output and hasattr(ret, &quot;toarray&quot;)):</span>
<span class="ne">--&gt; </span><span class="mi">156</span><span class="s2">         return ret.toarray()</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span><span class="s2">     return ret</span>
<span class="g g-Whitespace">    </span><span class="mi">158</span><span class="s2"> </span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\scipy\sparse\compressed.py</span> in <span class="ni">toarray</span><span class="nt">(self, order, out)</span>
<span class="g g-Whitespace">   </span><span class="mi">1029</span><span class="s2">         if out is None and order is None:</span>
<span class="g g-Whitespace">   </span><span class="mi">1030</span><span class="s2">             order = self._swap(&#39;cf&#39;)[0]</span>
<span class="ne">-&gt; </span><span class="mi">1031</span><span class="s2">         out = self._process_toarray_args(order, out)</span>
<span class="g g-Whitespace">   </span><span class="mi">1032</span><span class="s2">         if not (out.flags.c_contiguous or out.flags.f_contiguous):</span>
<span class="g g-Whitespace">   </span><span class="mi">1033</span><span class="s2">             raise ValueError(&#39;Output array must be C or F contiguous&#39;)</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\scipy\sparse\base.py</span> in <span class="ni">_process_toarray_args</span><span class="nt">(self, order, out)</span>
<span class="g g-Whitespace">   </span><span class="mi">1200</span><span class="s2">             return out</span>
<span class="g g-Whitespace">   </span><span class="mi">1201</span><span class="s2">         else:</span>
<span class="ne">-&gt; </span><span class="mi">1202</span><span class="s2">             return np.zeros(self.shape, dtype=self.dtype, order=order)</span>
<span class="g g-Whitespace">   </span><span class="mi">1203</span><span class="s2"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1204</span><span class="s2"> </span>

<span class="ne">MemoryError</span>: Unable to allocate 2.32 GiB for an array with shape (17632, 17632) and data type float64
</pre></div>
</div>
</div>
</div>
<p>As we are using the TF-IDF Vectoriser, we can calculate the dot product between each vector to give us the cosine similarity score. This is more efficient than to use cosine_similarities().</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cosine_sim</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(17632, 17632)
</pre></div>
</div>
</div>
</div>
<p>This makes sense as this similarity is comparing each artist to each other, so each artist has it’s own column and it’s own row.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cosine_sim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0., 0., 1., ..., 0., 0., 0.])
</pre></div>
</div>
</div>
</div>
<p>This is an example of the cosine similarities for the artist with the ID 2.</p>
<p>The artist will have 100% similarity with itself, hence there is 1.0 in the 2nd column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">indices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">artists_tags</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The above ‘indices’ series is created to reverse the mapping of artist names and IDs, this allows for easier searching in the recommender system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_recommendations</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cosine_sim</span><span class="o">=</span><span class="n">cosine_sim</span><span class="p">):</span>
    <span class="c1"># Get the index of the artist that matches the name</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="c1"># Get the pairwsie similarity scores of all artists with that artist</span>
    <span class="n">sim_scores</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">cosine_sim</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>

    <span class="c1"># Sort the artists based on the similarity scores</span>
    <span class="n">sim_scores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sim_scores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Get the scores of the 10 most similar artists</span>
    <span class="n">sim_scores</span> <span class="o">=</span> <span class="n">sim_scores</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span>

    <span class="c1"># Get the artist indices</span>
    <span class="n">artist_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sim_scores</span><span class="p">]</span>

    <span class="c1"># Return the top 10 most similar movies</span>
    <span class="k">return</span> <span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">artist_indices</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The above function retrieves the top 10 recommendations based on the most common tag that each artist received.</p>
<p>This will work quite well for artists that have received lots of the same tag, making it more accurate, and may not perform as well on artists with few/no tags.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_recommendations</span><span class="p">(</span><span class="s1">&#39;Kanye West&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>238     Flagelo Urbano
243             Common
249               Nach
253         9th Wonder
261                Nas
265            Mos Def
272               2Pac
300    Black Eyed Peas
325         Kanye West
454           Noize MC
Name: name, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists_tags</span><span class="p">[</span><span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Flagelo Urbano&#39;</span><span class="p">]</span> <span class="c1">## hip hop under, raptuga, underground hip hp, hip hop</span>
<span class="n">artists_tags</span><span class="p">[</span><span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Common&#39;</span><span class="p">]</span> <span class="c1">## hip-hop, hip hop, rap, mean, 90s</span>
<span class="n">artists_tags</span><span class="p">[</span><span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Nach&#39;</span><span class="p">]</span> <span class="c1">## hip-hop</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>url</th>
      <th>pictureURL</th>
      <th>first_tag</th>
      <th>second_tag</th>
      <th>top_five_tags</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>249</th>
      <td>249</td>
      <td>Nach</td>
      <td>http://www.last.fm/music/Nach</td>
      <td>http://userserve-ak.last.fm/serve/252/2510461.jpg</td>
      <td>hip-hop</td>
      <td></td>
      <td>hip-hop</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_recommendations</span><span class="p">(</span><span class="s1">&#39;Coptic Rain&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1       Diary of Dreams
2     Carpathian Forest
3          Moi dix Mois
4           Bella Morte
5             Moonspell
6        Marilyn Manson
7           DIR EN GREY
8           Combichrist
9               Grendel
10             Agonoize
Name: name, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists_tags</span><span class="p">[</span><span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Diary of Dreams&#39;</span><span class="p">]</span> <span class="c1">## darkwave, german, gothic, seen live, industrial</span>
<span class="n">artists_tags</span><span class="p">[</span><span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Carpathian Forest&#39;</span><span class="p">]</span> <span class="c1">## black metal, true norwegian black metal, norwegian</span>
<span class="n">artists_tags</span><span class="p">[</span><span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Moi dix Mois&#39;</span><span class="p">]</span> <span class="c1">## j-rock, japanese, visual kei, gothic metal</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>url</th>
      <th>pictureURL</th>
      <th>first_tag</th>
      <th>second_tag</th>
      <th>top_five_tags</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Bella Morte</td>
      <td>http://www.last.fm/music/Bella+Morte</td>
      <td>http://userserve-ak.last.fm/serve/252/14789013...</td>
      <td>darkwave</td>
      <td>gothic</td>
      <td>darkwave gothic gothic rock deathrock covers</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As you can see when we run ‘Kanye West’ into the recommender system, we are given lots of artist that are related to hip-hop or rap. Although, the third recommendation, Nach, only has one tag assigned to it, which suggests that Nach received very few tags, and may not be similar to Kanye West.</p>
<p>With our second example, we ran ‘Coptic Rain’ into the recommender system, to see how it would perform on an artist that had no tags. The tags of the top three recommended artists seem to be quite random (darkwave, german, norwegian, japanese). The system performed quite poorly for this artist.</p>
</div>
</div>
<div class="section" id="using-the-top-5-instead-of-top-1-tags">
<h2>Using the Top-5 Instead of Top-1 Tags<a class="headerlink" href="#using-the-top-5-instead-of-top-1-tags" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;top_five_tags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;top_five_tags&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_name_and_tags</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;top_five_tags&#39;</span><span class="p">]</span>

<span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;name_and_tags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">artists_tags</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">find_name_and_tags</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The name of the artist may be important to use in the recommender system as it may be referenced within some of the tags.</p>
<p>Some of the tags produced by the users may contain comments such as “sounds like michael jackson”, and in this case it can create relations between Michael Jackson and these comments. It can also build relationships where the artist name may appear as “Jay-Z ft. Kanye West”, so that Jay-Z and Kanye West could achieve a larger cosine similarity.</p>
<p>We are merging the name and the tags into one column to simplify things.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">stop_words</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
<span class="n">count_matrix</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;name_and_tags&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>In this case, we use CountVectorizer() instead of TF-IDF, as previously done. This is just to avoid down-weighting important tags that may appear more often than others.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">count_matrix</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(17632, 20107)
</pre></div>
</div>
</div>
</div>
<p>There are much more words being produced when we accept the top 5 tags and the name of the artists.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cosine_sim2</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">count_matrix</span><span class="p">,</span> <span class="n">count_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">indices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">artists_tags</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">artists_tags</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Here, we are creating the new cosine similarity matrix and the new indices object that can be passed into our original get_recommendations() function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_recommendations</span><span class="p">(</span><span class="s1">&#39;Kanye West&#39;</span><span class="p">,</span> <span class="n">cosine_sim2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2578     will.i.am
16355        Trina
898      Timbaland
1435          Akon
3280         Drake
6425         Diddy
7596        Chingy
7968        T-Pain
7991        Fugees
11483         Iyaz
Name: name, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_recommendations</span><span class="p">(</span><span class="s1">&#39;Coptic Rain&#39;</span><span class="p">,</span> <span class="n">cosine_sim2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>15869        City Rain
7461              Rain
9187     The Mavericks
12739      Room Eleven
1469       B.J. Thomas
12457       Black Rain
954              Yanni
2053            Yiruma
3537        Gary Allan
3559       Clint Black
Name: name, dtype: object
</pre></div>
</div>
</div>
</div>
<p>When we run ‘Kanye West’ in the new recommender system, it seems to output more accurate results, the top 10 similar artists seem to be more similar this time.</p>
<p>However, when we run ‘Coptic Rain’, who has no tags, we get other artists with very similar names, as it is the only token being considered.</p>
</div>
<span id="document-Page 7 - Collaborative Filtering Recommender"></span><div class="section" id="collaborative-filtering-recommender-system">
<h2>Collaborative Filtering Recommender System<a class="headerlink" href="#collaborative-filtering-recommender-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="importing-relevant-packages-and-datasets">
<h3>Importing Relevant Packages and Datasets<a class="headerlink" href="#importing-relevant-packages-and-datasets" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">tensorflow.compat.v1</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">disable_v2_behavior</span><span class="p">()</span>
<span class="n">tf</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

<span class="c1"># Add some convenience functions to Pandas DataFrame.</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:tensorflow:From C:\Users\laram\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\tensorflow\python\compat\v2_compat.py:111: disable_resource_variables (from tensorflow.python.ops.variable_scope) is deprecated and will be removed in a future version.
Instructions for updating:
non-resource variables are not supported in the long term
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_artists</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/user_artists_ratings.csv&#39;</span><span class="p">)</span>
<span class="n">user_friends</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/user_friends.csv&#39;</span><span class="p">)</span>
<span class="n">user_taggedartists</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/user_taggedartists.csv&#39;</span><span class="p">)</span>
<span class="n">artists</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/artists.csv&#39;</span><span class="p">)</span>
<span class="n">tags</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/tags.csv&#39;</span><span class="p">)</span>
<span class="n">artists_tags</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/artists_tags.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="creating-functions-to-build-sparse-tensor-and-calculate-mse">
<h3>Creating Functions to Build Sparse Tensor and Calculate MSE<a class="headerlink" href="#creating-functions-to-build-sparse-tensor-and-calculate-mse" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_rating_sparse_tensor</span><span class="p">(</span><span class="n">user_artists_df</span><span class="p">):</span>

    <span class="n">indices</span> <span class="o">=</span> <span class="n">user_artists_df</span><span class="p">[[</span><span class="s1">&#39;userID&#39;</span><span class="p">,</span> <span class="s1">&#39;artistID&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">user_artists_df</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">(</span>
        <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
        <span class="n">dense_shape</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">user_artists</span><span class="o">.</span><span class="n">userID</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="n">artists</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sparse_mean_square_error</span><span class="p">(</span><span class="n">sparse_ratings</span><span class="p">,</span> <span class="n">user_embeddings</span><span class="p">,</span> <span class="n">music_embeddings</span><span class="p">):</span>

    <span class="n">predictions</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">user_embeddings</span><span class="p">,</span> <span class="n">sparse_ratings</span><span class="o">.</span><span class="n">indices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">music_embeddings</span><span class="p">,</span> <span class="n">sparse_ratings</span><span class="o">.</span><span class="n">indices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">sparse_ratings</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="creating-functions-to-build-a-collaborative-filtering-model">
<h3>Creating Functions to Build a Collaborative-Filtering Model<a class="headerlink" href="#creating-functions-to-build-a-collaborative-filtering-model" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CFModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple class that represents a collaborative filtering model&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embedding_vars</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes a CFModel.</span>
<span class="sd">        Args:</span>
<span class="sd">          embedding_vars: A dictionary of tf.Variables.</span>
<span class="sd">          loss: A float Tensor. The loss to optimize.</span>
<span class="sd">          metrics: optional list of dictionaries of Tensors. The metrics in each</span>
<span class="sd">            dictionary will be plotted in a separate figure during training.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_embedding_vars</span> <span class="o">=</span> <span class="n">embedding_vars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loss</span> <span class="o">=</span> <span class="n">loss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span> <span class="o">=</span> <span class="n">metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_embeddings</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">embedding_vars</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">embeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The embeddings dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_embeddings</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">plot_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">GradientDescentOptimizer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Trains the model.</span>
<span class="sd">        Args:</span>
<span class="sd">          iterations: number of iterations to run.</span>
<span class="sd">          learning_rate: optimizer learning rate.</span>
<span class="sd">          plot_results: whether to plot the results at the end of training.</span>
<span class="sd">          optimizer: the optimizer to use. Default to GradientDescentOptimizer.</span>
<span class="sd">        Returns:</span>
<span class="sd">          The metrics dictionary evaluated at the last iteration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loss</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">(</span><span class="n">learning_rate</span><span class="p">)</span>
            <span class="n">train_op</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loss</span><span class="p">)</span>
            <span class="n">local_init_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">group</span><span class="p">(</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">variables_initializer</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">variables</span><span class="p">()),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">local_variables_initializer</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">tables_initializer</span><span class="p">())</span>
                    <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">start_queue_runners</span><span class="p">()</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
            <span class="n">local_init_op</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="n">iterations</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span> <span class="ow">or</span> <span class="p">({},)</span>
            <span class="n">metrics_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">]</span>

            <span class="c1"># Train and append results.</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iterations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">run</span><span class="p">((</span><span class="n">train_op</span><span class="p">,</span> <span class="n">metrics</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="n">num_iterations</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2"> iteration </span><span class="si">%d</span><span class="s2">: &quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">items</span><span class="p">()]),</span>
                          <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">iterations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">metric_val</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">metrics_vals</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">metric_val</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_embedding_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_embeddings</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">plot_results</span><span class="p">:</span>
                <span class="c1"># Plot the metrics.</span>
                <span class="n">num_subplots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">num_subplots</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">metric_vals</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics_vals</span><span class="p">):</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_subplots</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">metric_vals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iterations</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_iterations</span><span class="p">])</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of Iterations&quot;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean Squared Error&quot;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Training and Testing Errors&quot;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_model</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">init_stddev</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
    
    <span class="c1"># Split the ratings DataFrame into train and test</span>
    <span class="n">train_ratings</span><span class="p">,</span> <span class="n">test_ratings</span> <span class="o">=</span> <span class="n">split_dataframe</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
    <span class="c1"># SparseTensor representation of the train and test datasets.</span>
    <span class="n">A_train</span> <span class="o">=</span> <span class="n">build_rating_sparse_tensor</span><span class="p">(</span><span class="n">train_ratings</span><span class="p">)</span>
    <span class="n">A_test</span> <span class="o">=</span> <span class="n">build_rating_sparse_tensor</span><span class="p">(</span><span class="n">test_ratings</span><span class="p">)</span>
    <span class="c1"># Initialize the embeddings using a normal distribution.</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">random_normal</span><span class="p">(</span>
        <span class="p">[</span><span class="n">A_train</span><span class="o">.</span><span class="n">dense_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">embedding_dim</span><span class="p">],</span> <span class="n">stddev</span><span class="o">=</span><span class="n">init_stddev</span><span class="p">))</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">random_normal</span><span class="p">(</span>
        <span class="p">[</span><span class="n">A_train</span><span class="o">.</span><span class="n">dense_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">embedding_dim</span><span class="p">],</span> <span class="n">stddev</span><span class="o">=</span><span class="n">init_stddev</span><span class="p">))</span>
    <span class="n">train_loss</span> <span class="o">=</span> <span class="n">sparse_mean_square_error</span><span class="p">(</span><span class="n">A_train</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
    <span class="n">test_loss</span> <span class="o">=</span> <span class="n">sparse_mean_square_error</span><span class="p">(</span><span class="n">A_test</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;train_error&#39;</span><span class="p">:</span> <span class="n">train_loss</span><span class="p">,</span>
        <span class="s1">&#39;test_error&#39;</span><span class="p">:</span> <span class="n">test_loss</span>
    <span class="p">}</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;userID&quot;</span><span class="p">:</span> <span class="n">U</span><span class="p">,</span>
        <span class="s2">&quot;artistID&quot;</span><span class="p">:</span> <span class="n">V</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">CFModel</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">,</span> <span class="p">[</span><span class="n">metrics</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">split_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">holdout_fraction</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
  
    <span class="n">test</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="n">holdout_fraction</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="building-and-training-the-model">
<h3>Building and Training the Model<a class="headerlink" href="#building-and-training-the-model" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">user_artists</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">init_stddev</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 0: train_error=7.674745, test_error=7.676869
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 10: train_error=6.973046, test_error=7.464542
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 20: train_error=6.428425, test_error=7.316956
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 30: train_error=5.963654, test_error=7.190217
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 40: train_error=5.533082, test_error=7.055270
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 50: train_error=5.107881, test_error=6.890791
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 60: train_error=4.678211, test_error=6.688717
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 70: train_error=4.255985, test_error=6.460946
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 80: train_error=3.861839, test_error=6.230646
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 90: train_error=3.507273, test_error=6.014506
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 100: train_error=3.193339, test_error=5.818508
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 110: train_error=2.917263, test_error=5.643669
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 120: train_error=2.675326, test_error=5.489468
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 130: train_error=2.463389, test_error=5.354567
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 140: train_error=2.277289, test_error=5.237117
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 150: train_error=2.113181, test_error=5.135093
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 160: train_error=1.967715, test_error=5.046528
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 170: train_error=1.838059, test_error=4.969631
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 180: train_error=1.721860, test_error=4.902824
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 190: train_error=1.617180, test_error=4.844743
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 200: train_error=1.522428, test_error=4.794218
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 210: train_error=1.436290, test_error=4.750252
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 220: train_error=1.357679, test_error=4.711993
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 230: train_error=1.285689, test_error=4.678712
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 240: train_error=1.219560, test_error=4.649786
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 250: train_error=1.158646, test_error=4.624678
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 260: train_error=1.102397, test_error=4.602925
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 270: train_error=1.050340, test_error=4.584130
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 280: train_error=1.002065, test_error=4.567944
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 290: train_error=0.957216, test_error=4.554067
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 300: train_error=0.915479, test_error=4.542235
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 310: train_error=0.876578, test_error=4.532219
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 320: train_error=0.840269, test_error=4.523817
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 330: train_error=0.806334, test_error=4.516850
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 340: train_error=0.774578, test_error=4.511162
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 350: train_error=0.744826, test_error=4.506617
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 360: train_error=0.716921, test_error=4.503088
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 370: train_error=0.690719, test_error=4.500470
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 380: train_error=0.666093, test_error=4.498664
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 390: train_error=0.642924, test_error=4.497585
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 400: train_error=0.621107, test_error=4.497155
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 410: train_error=0.600542, test_error=4.497307
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 420: train_error=0.581141, test_error=4.497978
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 430: train_error=0.562822, test_error=4.499113
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 440: train_error=0.545510, test_error=4.500663
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 450: train_error=0.529134, test_error=4.502584
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 460: train_error=0.513633, test_error=4.504835
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 470: train_error=0.498946, test_error=4.507381
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 480: train_error=0.485019, test_error=4.510190
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 490: train_error=0.471802, test_error=4.513234
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 500: train_error=0.459249, test_error=4.516484
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 510: train_error=0.447317, test_error=4.519921
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 520: train_error=0.435965, test_error=4.523520
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 530: train_error=0.425158, test_error=4.527264
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 540: train_error=0.414859, test_error=4.531136
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 550: train_error=0.405039, test_error=4.535119
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 560: train_error=0.395666, test_error=4.539202
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 570: train_error=0.386714, test_error=4.543370
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 580: train_error=0.378157, test_error=4.547613
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 590: train_error=0.369971, test_error=4.551921
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 600: train_error=0.362134, test_error=4.556286
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 610: train_error=0.354625, test_error=4.560698
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 620: train_error=0.347425, test_error=4.565149
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 630: train_error=0.340517, test_error=4.569636
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 640: train_error=0.333882, test_error=4.574151
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 650: train_error=0.327507, test_error=4.578688
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 660: train_error=0.321376, test_error=4.583243
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 670: train_error=0.315475, test_error=4.587811
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 680: train_error=0.309793, test_error=4.592391
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 690: train_error=0.304316, test_error=4.596976
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 700: train_error=0.299035, test_error=4.601566
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 710: train_error=0.293938, test_error=4.606156
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 720: train_error=0.289016, test_error=4.610745
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 730: train_error=0.284260, test_error=4.615329
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 740: train_error=0.279662, test_error=4.619909
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 750: train_error=0.275212, test_error=4.624481
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 760: train_error=0.270905, test_error=4.629044
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 770: train_error=0.266732, test_error=4.633598
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 780: train_error=0.262687, test_error=4.638139
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 790: train_error=0.258765, test_error=4.642668
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 800: train_error=0.254959, test_error=4.647182
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 810: train_error=0.251263, test_error=4.651683
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 820: train_error=0.247673, test_error=4.656168
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 830: train_error=0.244184, test_error=4.660638
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 840: train_error=0.240792, test_error=4.665092
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 850: train_error=0.237491, test_error=4.669528
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 860: train_error=0.234278, test_error=4.673947
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 870: train_error=0.231150, test_error=4.678349
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 880: train_error=0.228101, test_error=4.682732
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 890: train_error=0.225131, test_error=4.687097
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 900: train_error=0.222234, test_error=4.691444
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 910: train_error=0.219407, test_error=4.695772
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 920: train_error=0.216649, test_error=4.700081
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 930: train_error=0.213957, test_error=4.704371
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 940: train_error=0.211327, test_error=4.708642
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 950: train_error=0.208757, test_error=4.712893
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 960: train_error=0.206246, test_error=4.717125
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 970: train_error=0.203790, test_error=4.721338
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 980: train_error=0.201389, test_error=4.725532
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 990: train_error=0.199039, test_error=4.729705
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1000: train_error=0.196739, test_error=4.733860
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1010: train_error=0.194487, test_error=4.737995
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1020: train_error=0.192282, test_error=4.742110
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1030: train_error=0.190122, test_error=4.746207
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1040: train_error=0.188006, test_error=4.750283
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1050: train_error=0.185931, test_error=4.754341
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1060: train_error=0.183897, test_error=4.758379
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1070: train_error=0.181902, test_error=4.762398
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1080: train_error=0.179945, test_error=4.766398
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1090: train_error=0.178025, test_error=4.770379
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1100: train_error=0.176141, test_error=4.774340
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1110: train_error=0.174291, test_error=4.778284
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1120: train_error=0.172475, test_error=4.782208
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1130: train_error=0.170691, test_error=4.786114
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_15636</span><span class="o">/</span><span class="mf">460896045.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">user_artists</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">init_stddev</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>

<span class="nn">~\AppData\Local\Temp/ipykernel_15636/701340561.py</span> in <span class="ni">train</span><span class="nt">(self, num_iterations, learning_rate, plot_results, optimizer)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>             <span class="c1"># Train and append results.</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span>             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iterations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">54</span>                 <span class="n">_</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">run</span><span class="p">((</span><span class="n">train_op</span><span class="p">,</span> <span class="n">metrics</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span>                 <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="n">num_iterations</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span>                     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2"> iteration </span><span class="si">%d</span><span class="s2">: &quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\tensorflow\python\client\session.py</span> in <span class="ni">run</span><span class="nt">(self, fetches, feed_dict, options, run_metadata)</span>
<span class="g g-Whitespace">    </span><span class="mi">968</span> 
<span class="g g-Whitespace">    </span><span class="mi">969</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">970</span>       <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">fetches</span><span class="p">,</span> <span class="n">feed_dict</span><span class="p">,</span> <span class="n">options_ptr</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">971</span>                          <span class="n">run_metadata_ptr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">972</span>       <span class="k">if</span> <span class="n">run_metadata</span><span class="p">:</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\tensorflow\python\client\session.py</span> in <span class="ni">_run</span><span class="nt">(self, handle, fetches, feed_dict, options, run_metadata)</span>
<span class="g g-Whitespace">   </span><span class="mi">1191</span>     <span class="c1"># or if the call is a partial run that specifies feeds.</span>
<span class="g g-Whitespace">   </span><span class="mi">1192</span>     <span class="k">if</span> <span class="n">final_fetches</span> <span class="ow">or</span> <span class="n">final_targets</span> <span class="ow">or</span> <span class="p">(</span><span class="n">handle</span> <span class="ow">and</span> <span class="n">feed_dict_tensor</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1193</span>       <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_run</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">final_targets</span><span class="p">,</span> <span class="n">final_fetches</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1194</span>                              <span class="n">feed_dict_tensor</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">run_metadata</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1195</span>     <span class="k">else</span><span class="p">:</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\tensorflow\python\client\session.py</span> in <span class="ni">_do_run</span><span class="nt">(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)</span>
<span class="g g-Whitespace">   </span><span class="mi">1371</span> 
<span class="g g-Whitespace">   </span><span class="mi">1372</span>     <span class="k">if</span> <span class="n">handle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1373</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_call</span><span class="p">(</span><span class="n">_run_fn</span><span class="p">,</span> <span class="n">feeds</span><span class="p">,</span> <span class="n">fetches</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1374</span>                            <span class="n">run_metadata</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1375</span>     <span class="k">else</span><span class="p">:</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\tensorflow\python\client\session.py</span> in <span class="ni">_do_call</span><span class="nt">(self, fn, *args)</span>
<span class="g g-Whitespace">   </span><span class="mi">1378</span>   <span class="k">def</span> <span class="nf">_do_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1379</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1380</span>       <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1381</span>     <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">OpError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1382</span>       <span class="n">message</span> <span class="o">=</span> <span class="n">compat</span><span class="o">.</span><span class="n">as_text</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\tensorflow\python\client\session.py</span> in <span class="ni">_run_fn</span><span class="nt">(feed_dict, fetch_list, target_list, options, run_metadata)</span>
<span class="g g-Whitespace">   </span><span class="mi">1361</span>       <span class="c1"># Ensure any changes to the graph are reflected in the runtime.</span>
<span class="g g-Whitespace">   </span><span class="mi">1362</span>       <span class="bp">self</span><span class="o">.</span><span class="n">_extend_graph</span><span class="p">()</span>
<span class="ne">-&gt; </span><span class="mi">1363</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_tf_sessionrun</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">feed_dict</span><span class="p">,</span> <span class="n">fetch_list</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1364</span>                                       <span class="n">target_list</span><span class="p">,</span> <span class="n">run_metadata</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1365</span> 

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\tensorflow\python\client\session.py</span> in <span class="ni">_call_tf_sessionrun</span><span class="nt">(self, options, feed_dict, fetch_list, target_list, run_metadata)</span>
<span class="g g-Whitespace">   </span><span class="mi">1454</span>   <span class="k">def</span> <span class="nf">_call_tf_sessionrun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">feed_dict</span><span class="p">,</span> <span class="n">fetch_list</span><span class="p">,</span> <span class="n">target_list</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1455</span>                           <span class="n">run_metadata</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1456</span>     <span class="k">return</span> <span class="n">tf_session</span><span class="o">.</span><span class="n">TF_SessionRun_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">feed_dict</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1457</span>                                             <span class="n">fetch_list</span><span class="p">,</span> <span class="n">target_list</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1458</span>                                             <span class="n">run_metadata</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">user_artists</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">init_stddev</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 2000: train_error=3.266350, test_error=5.835364
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;train_error&#39;: 3.26635, &#39;test_error&#39;: 5.8353643}]
</pre></div>
</div>
<img alt="_images/Page 7 - Collaborative Filtering Recommender_13_2.png" src="_images/Page 7 - Collaborative Filtering Recommender_13_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">user_artists</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">init_stddev</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 2000: train_error=0.434694, test_error=3.144789
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;train_error&#39;: 0.43469417, &#39;test_error&#39;: 3.1447892}]
</pre></div>
</div>
<img alt="_images/Page 7 - Collaborative Filtering Recommender_14_2.png" src="_images/Page 7 - Collaborative Filtering Recommender_14_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="inspect-embeddings">
<h2>Inspect Embeddings<a class="headerlink" href="#inspect-embeddings" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DOT</span> <span class="o">=</span> <span class="s1">&#39;dot&#39;</span>
<span class="n">COSINE</span> <span class="o">=</span> <span class="s1">&#39;cosine&#39;</span>
<span class="k">def</span> <span class="nf">compute_scores</span><span class="p">(</span><span class="n">query_embedding</span><span class="p">,</span> <span class="n">item_embeddings</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="n">DOT</span><span class="p">):</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">query_embedding</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">item_embeddings</span>
    <span class="k">if</span> <span class="n">measure</span> <span class="o">==</span> <span class="n">COSINE</span><span class="p">:</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scores</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">artist_neighbors</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">title_substring</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="n">DOT</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">ids</span> <span class="o">=</span>  <span class="n">artists</span><span class="p">[</span><span class="n">artists</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">title_substring</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="n">artists</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Found no artist with title </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">title_substring</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest neighbors of : </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">titles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Found more than one matching artist. Other candidates: </span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>
    <span class="n">artistID</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">compute_scores</span><span class="p">(</span>
        <span class="n">model</span><span class="o">.</span><span class="n">embeddings</span><span class="p">[</span><span class="s2">&quot;artistID&quot;</span><span class="p">][</span><span class="n">artistID</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">embeddings</span><span class="p">[</span><span class="s2">&quot;artistID&quot;</span><span class="p">],</span>
        <span class="n">measure</span><span class="p">)</span>
    <span class="n">score_key</span> <span class="o">=</span> <span class="n">measure</span> <span class="o">+</span> <span class="s1">&#39; score&#39;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="n">score_key</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
        <span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">artists</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
    <span class="p">})</span>
    <span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="n">score_key</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artist_neighbors</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;Kanye&quot;</span><span class="p">,</span> <span class="n">DOT</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nearest neighbors of : Kanye West.
[Found more than one matching artist. Other candidates: Kanye West &amp; Jay-Z, Kanye West, Beyoncé &amp; Charlie Wilson, Kanye West feat. Pusha T MpTri.Net, Eminem feat. Drake, Kanye West, Lil Wayne, The-Dream f. Kanye West, Jamie Foxx feat. Kanye West and The-Dream]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dot score</th>
      <th>names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3833</th>
      <td>3.895</td>
      <td>Bad Boys Blue</td>
    </tr>
    <tr>
      <th>3227</th>
      <td>3.765</td>
      <td>Marillion</td>
    </tr>
    <tr>
      <th>257</th>
      <td>3.647</td>
      <td>Jill Scott</td>
    </tr>
    <tr>
      <th>8177</th>
      <td>3.606</td>
      <td>Axel Fernando</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.570</td>
      <td>Diary of Dreams</td>
    </tr>
    <tr>
      <th>61</th>
      <td>3.489</td>
      <td>Madonna</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artist_neighbors</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;Kanye&quot;</span><span class="p">,</span> <span class="n">COSINE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nearest neighbors of : Kanye West.
[Found more than one matching artist. Other candidates: Kanye West &amp; Jay-Z, Kanye West, Beyoncé &amp; Charlie Wilson, Kanye West feat. Pusha T MpTri.Net, Eminem feat. Drake, Kanye West, Lil Wayne, The-Dream f. Kanye West, Jamie Foxx feat. Kanye West and The-Dream]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cosine score</th>
      <th>names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>325</th>
      <td>1.000</td>
      <td>Kanye West</td>
    </tr>
    <tr>
      <th>9110</th>
      <td>0.947</td>
      <td>Airbag</td>
    </tr>
    <tr>
      <th>176</th>
      <td>0.931</td>
      <td>Keane</td>
    </tr>
    <tr>
      <th>2570</th>
      <td>0.924</td>
      <td>Auto!Automatic!!</td>
    </tr>
    <tr>
      <th>683</th>
      <td>0.923</td>
      <td>Florence + the Machine</td>
    </tr>
    <tr>
      <th>5825</th>
      <td>0.922</td>
      <td>Cash Cash</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_lowinit</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">user_artists</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">init_stddev</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">model_lowinit</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>
<span class="n">artist_neighbors</span><span class="p">(</span><span class="n">model_lowinit</span><span class="p">,</span> <span class="s2">&quot;Kanye&quot;</span><span class="p">,</span> <span class="n">DOT</span><span class="p">)</span>
<span class="n">artist_neighbors</span><span class="p">(</span><span class="n">model_lowinit</span><span class="p">,</span> <span class="s2">&quot;Kanye&quot;</span><span class="p">,</span> <span class="n">COSINE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 1000: train_error=0.365735, test_error=1.977160Nearest neighbors of : Kanye West.
[Found more than one matching artist. Other candidates: Kanye West &amp; Jay-Z, Kanye West, Beyoncé &amp; Charlie Wilson, Kanye West feat. Pusha T MpTri.Net, Eminem feat. Drake, Kanye West, Lil Wayne, The-Dream f. Kanye West, Jamie Foxx feat. Kanye West and The-Dream]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dot score</th>
      <th>names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>325</th>
      <td>6.341</td>
      <td>Kanye West</td>
    </tr>
    <tr>
      <th>300</th>
      <td>5.148</td>
      <td>Black Eyed Peas</td>
    </tr>
    <tr>
      <th>894</th>
      <td>4.058</td>
      <td>Amy Winehouse</td>
    </tr>
    <tr>
      <th>458</th>
      <td>3.739</td>
      <td>3OH!3</td>
    </tr>
    <tr>
      <th>50</th>
      <td>3.653</td>
      <td>Daft Punk</td>
    </tr>
    <tr>
      <th>455</th>
      <td>3.374</td>
      <td>Miley Cyrus</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nearest neighbors of : Kanye West.
[Found more than one matching artist. Other candidates: Kanye West &amp; Jay-Z, Kanye West, Beyoncé &amp; Charlie Wilson, Kanye West feat. Pusha T MpTri.Net, Eminem feat. Drake, Kanye West, Lil Wayne, The-Dream f. Kanye West, Jamie Foxx feat. Kanye West and The-Dream]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cosine score</th>
      <th>names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>325</th>
      <td>1.000</td>
      <td>Kanye West</td>
    </tr>
    <tr>
      <th>11036</th>
      <td>0.724</td>
      <td>Eminem feat. Drake, Kanye West, Lil Wayne</td>
    </tr>
    <tr>
      <th>6179</th>
      <td>0.683</td>
      <td>Lady GaGa Ft. Beyoncé</td>
    </tr>
    <tr>
      <th>9154</th>
      <td>0.679</td>
      <td>Nancy Ajram</td>
    </tr>
    <tr>
      <th>277</th>
      <td>0.676</td>
      <td>Ana Carolina</td>
    </tr>
    <tr>
      <th>4606</th>
      <td>0.658</td>
      <td>John Legend</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="_images/Page 7 - Collaborative Filtering Recommender_20_4.png" src="_images/Page 7 - Collaborative Filtering Recommender_20_4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gravity</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a gravity loss given two embedding matrices.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">transpose_a</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">transpose_a</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">build_regularized_model</span><span class="p">(</span>
    <span class="n">ratings</span><span class="p">,</span> 
    <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
    <span class="n">regularization_coeff</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> 
    <span class="n">gravity_coeff</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
    <span class="n">init_stddev</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="c1"># Split the ratings DataFrame into train and test.</span>
    <span class="n">train_ratings</span><span class="p">,</span> <span class="n">test_ratings</span> <span class="o">=</span> <span class="n">split_dataframe</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
    <span class="c1"># SparseTensor representation of the train and test datasets.</span>
    <span class="n">A_train</span> <span class="o">=</span> <span class="n">build_rating_sparse_tensor</span><span class="p">(</span><span class="n">train_ratings</span><span class="p">)</span>
    <span class="n">A_test</span> <span class="o">=</span> <span class="n">build_rating_sparse_tensor</span><span class="p">(</span><span class="n">test_ratings</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">random_normal</span><span class="p">(</span>
        <span class="p">[</span><span class="n">A_train</span><span class="o">.</span><span class="n">dense_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">embedding_dim</span><span class="p">],</span> <span class="n">stddev</span><span class="o">=</span><span class="n">init_stddev</span><span class="p">))</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">random_normal</span><span class="p">(</span>
        <span class="p">[</span><span class="n">A_train</span><span class="o">.</span><span class="n">dense_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">embedding_dim</span><span class="p">],</span> <span class="n">stddev</span><span class="o">=</span><span class="n">init_stddev</span><span class="p">))</span>

    <span class="n">error_train</span> <span class="o">=</span> <span class="n">sparse_mean_square_error</span><span class="p">(</span><span class="n">A_train</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
    <span class="n">error_test</span> <span class="o">=</span> <span class="n">sparse_mean_square_error</span><span class="p">(</span><span class="n">A_test</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
    <span class="n">gravity_loss</span> <span class="o">=</span> <span class="n">gravity_coeff</span> <span class="o">*</span> <span class="n">gravity</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
    <span class="n">regularization_loss</span> <span class="o">=</span> <span class="n">regularization_coeff</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">U</span><span class="p">)</span><span class="o">/</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">V</span><span class="o">*</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">total_loss</span> <span class="o">=</span> <span class="n">error_train</span> <span class="o">+</span> <span class="n">regularization_loss</span> <span class="o">+</span> <span class="n">gravity_loss</span>
    <span class="n">losses</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;train_error_observed&#39;</span><span class="p">:</span> <span class="n">error_train</span><span class="p">,</span>
        <span class="s1">&#39;test_error_observed&#39;</span><span class="p">:</span> <span class="n">error_test</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">loss_components</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;observed_loss&#39;</span><span class="p">:</span> <span class="n">error_train</span><span class="p">,</span>
        <span class="s1">&#39;regularization_loss&#39;</span><span class="p">:</span> <span class="n">regularization_loss</span><span class="p">,</span>
        <span class="s1">&#39;gravity_loss&#39;</span><span class="p">:</span> <span class="n">gravity_loss</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;userId&quot;</span><span class="p">:</span> <span class="n">U</span><span class="p">,</span> <span class="s2">&quot;artistID&quot;</span><span class="p">:</span> <span class="n">V</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">CFModel</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">total_loss</span><span class="p">,</span> <span class="p">[</span><span class="n">losses</span><span class="p">,</span> <span class="n">loss_components</span><span class="p">]),</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_model</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">build_regularized_model</span><span class="p">(</span>
    <span class="n">user_artists</span><span class="p">,</span> <span class="n">regularization_coeff</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">gravity_coeff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
    <span class="n">init_stddev</span><span class="o">=</span><span class="mf">.05</span><span class="p">)</span>
<span class="n">reg_model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">20.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 2000: train_error_observed=0.148672, test_error_observed=2.516972, observed_loss=0.148672, regularization_loss=0.467933, gravity_loss=0.192609
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;train_error_observed&#39;: 0.14867209, &#39;test_error_observed&#39;: 2.5169723},
 {&#39;observed_loss&#39;: 0.14867209,
  &#39;regularization_loss&#39;: 0.46793318,
  &#39;gravity_loss&#39;: 0.19260909}]
</pre></div>
</div>
<img alt="_images/Page 7 - Collaborative Filtering Recommender_22_2.png" src="_images/Page 7 - Collaborative Filtering Recommender_22_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artist_neighbors</span><span class="p">(</span><span class="n">reg_model</span><span class="p">,</span> <span class="s2">&quot;Kanye&quot;</span><span class="p">,</span> <span class="n">DOT</span><span class="p">)</span>
<span class="n">artist_neighbors</span><span class="p">(</span><span class="n">reg_model</span><span class="p">,</span> <span class="s2">&quot;Kanye&quot;</span><span class="p">,</span> <span class="n">COSINE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nearest neighbors of : Kanye West.
[Found more than one matching artist. Other candidates: Kanye West &amp; Jay-Z, Kanye West, Beyoncé &amp; Charlie Wilson, Kanye West feat. Pusha T MpTri.Net, Eminem feat. Drake, Kanye West, Lil Wayne, The-Dream f. Kanye West, Jamie Foxx feat. Kanye West and The-Dream]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dot score</th>
      <th>names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>325</th>
      <td>21.095</td>
      <td>Kanye West</td>
    </tr>
    <tr>
      <th>221</th>
      <td>15.184</td>
      <td>The Beatles</td>
    </tr>
    <tr>
      <th>283</th>
      <td>14.188</td>
      <td>Britney Spears</td>
    </tr>
    <tr>
      <th>294</th>
      <td>12.577</td>
      <td>Katy Perry</td>
    </tr>
    <tr>
      <th>83</th>
      <td>11.557</td>
      <td>Lady Gaga</td>
    </tr>
    <tr>
      <th>228</th>
      <td>11.408</td>
      <td>Nirvana</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nearest neighbors of : Kanye West.
[Found more than one matching artist. Other candidates: Kanye West &amp; Jay-Z, Kanye West, Beyoncé &amp; Charlie Wilson, Kanye West feat. Pusha T MpTri.Net, Eminem feat. Drake, Kanye West, Lil Wayne, The-Dream f. Kanye West, Jamie Foxx feat. Kanye West and The-Dream]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cosine score</th>
      <th>names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>325</th>
      <td>1.000</td>
      <td>Kanye West</td>
    </tr>
    <tr>
      <th>1072</th>
      <td>0.687</td>
      <td>Ace of Base</td>
    </tr>
    <tr>
      <th>1600</th>
      <td>0.666</td>
      <td>Lykke Li</td>
    </tr>
    <tr>
      <th>965</th>
      <td>0.659</td>
      <td>Amy Studt</td>
    </tr>
    <tr>
      <th>11027</th>
      <td>0.650</td>
      <td>drake and lil wayne</td>
    </tr>
    <tr>
      <th>3425</th>
      <td>0.650</td>
      <td>[unknown]</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<span id="document-Page 8 - Using the Recommender Systems"></span><div class="section" id="using-the-recommender-systems">
<h2>Using the Recommender Systems<a class="headerlink" href="#using-the-recommender-systems" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">basic_recommender_system</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">content_based_recommender</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<p>These recommender systems can be used if you create a local version of this repo and change some of the variables in this noetbook.</p>
</div>
<div class="section" id="guideline-to-use-the-basic-recommender-system">
<h2>Guideline to use the Basic Recommender System<a class="headerlink" href="#guideline-to-use-the-basic-recommender-system" title="Permalink to this headline">¶</a></h2>
<p>The <b>basic recommender system</b> can be called using the function Find_The_Most_Popular_Music().
The parameters are as follows:</p>
<ol class="simple">
<li><p>method : This is a string value, and can be either:</p>
<ul class="simple">
<li><p>most_users (default): Returns the two artists with the highest number of users</p></li>
<li><p>most_listens : Takes the top 10% of artists with the highest user count and returns the two with the highest number of listens</p></li>
<li><p>star_rating : Takes the top 10% of artists with the highest listens and removes artists with less than 5 users and returns the two artists with the highest average rating</p></li>
<li><p>custom : This is a customised option for recommendations. You get to decide how to filter the artists (top 10% of artists with the highest user count, top 25% of users with the highest listen count, top 5% of users with the highest star-ratings, etc.). It also allows you to choose the final basis for the recommendation (user_count, listen_count or star_rating). It allows for the following optional arguments:</p></li>
</ul>
</li>
<li><p>(optional) percentage_of_artists : This defaults to 10%. It takes the top 10% of artists based on your choice of filtering.</p></li>
<li><p>(optional) percentage_basis : This can be any of the following:</p>
<ul class="simple">
<li><p>user_count (default) : This takes the top percentage of artists based on the number of users listening to them</p></li>
<li><p>listen_count : This takes the top percentage of artists based on the number of times they’ve been listened to</p></li>
<li><p>star_rating : This takes the top percentage of artists based on their average star-rating</p></li>
</ul>
</li>
<li><p>(optional) recommendation_basis : This can be any of the following:</p>
<ul class="simple">
<li><p>user_count : This returns the top two artists based on the number of users listening to them</p></li>
<li><p>listen_count : This takes the top two artists based on the number of times they’ve been listened to</p></li>
<li><p>star_rating (default) : This takes the top two artists based on their average star-rating</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Find_The_Most_Popular_Music</span><span class="p">(</span><span class="s2">&quot;most_listens&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We think you might like Britney Spears, and you can view their profile through this link: http://www.last.fm/music/Britney+Spears
You might also like Depeche Mode, and you can view their profile through this link: http://www.last.fm/music/Depeche+Mode
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Find_The_Most_Popular_Music</span><span class="p">(</span><span class="s2">&quot;most_users&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We think you might like Lady Gaga, and you can view their profile through this link: http://www.last.fm/music/Lady+Gaga
You might also like Britney Spears, and you can view their profile through this link: http://www.last.fm/music/Britney+Spears
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Find_The_Most_Popular_Music</span><span class="p">(</span><span class="s2">&quot;star_rating&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We think you might like Duran Duran, and you can view their profile through this link: http://www.last.fm/music/Duran+Duran
You might also like The Smashing Pumpkins, and you can view their profile through this link: http://www.last.fm/music/The+Smashing+Pumpkins
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Find_The_Most_Popular_Music</span><span class="p">(</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span> 
    <span class="n">percentage_of_artists</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
    <span class="n">percentage_basis</span><span class="o">=</span><span class="s2">&quot;star_rating&quot;</span><span class="p">,</span>
    <span class="n">recommendation_basis</span><span class="o">=</span><span class="s2">&quot;most_users&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We think you might like Britney Spears, and you can view their profile through this link: http://www.last.fm/music/Britney+Spears
You might also like Depeche Mode, and you can view their profile through this link: http://www.last.fm/music/Depeche+Mode
</pre></div>
</div>
</div>
</div>
<p>This custom recommendation query retrieved the top 10% of artists that received the highest average user rating, and returned Britney Spears and Depeche Mode as the artists who have the most users listening.</p>
</div>
<div class="section" id="guideline-to-use-the-content-based-recommender-system">
<h2>Guideline to use the Content-Based Recommender System<a class="headerlink" href="#guideline-to-use-the-content-based-recommender-system" title="Permalink to this headline">¶</a></h2>
<p>There are two recommender systems created:</p>
<ol class="simple">
<li><p>A recommender system that calculates similarity based off only the top tag assigned to each artist.</p>
<ul class="simple">
<li><p>This can be called using <u>content_based_recommendation_1(artists_name, artists_tags, tags)</u></p></li>
</ul>
</li>
<li><p>A recommender system that calculates similarity based off their name and the top five tags assigned to each artist.</p>
<ul class="simple">
<li><p>This can be called using <u>content_based_recommendation_2(artists_name, artists_tags, tags)</u></p></li>
</ul>
</li>
</ol>
<p><b>Note:</b> These functions may not run depending on system resources (Memory Error). If this is the case, you can check the notebook ‘Content-Based Recommender System Workings’ as there are examples shown there.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists_tags</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/artists_tags.csv&#39;</span><span class="p">)</span>
<span class="n">tags</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/tags.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">content_based_recommendation_1</span><span class="p">(</span><span class="s1">&#39;Kanye West&#39;</span><span class="p">,</span> <span class="n">artists_tags</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">MemoryError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_32860</span><span class="o">/</span><span class="mf">3187041587.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">content_based_recommendation_1</span><span class="p">(</span><span class="s1">&#39;Kanye West&#39;</span><span class="p">,</span> <span class="n">artists_tags</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>

<span class="nn">~\CA4015\CA4015-Recommender-System\jupyter-book\content_based_recommender.py</span> in <span class="ni">content_based_recommendation_1</span><span class="nt">(artist_name, artist_tags_df, tags_df)</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> 
<span class="g g-Whitespace">     </span><span class="mi">57</span>     <span class="c1"># Defining the cosine similarity and storing in a matrix</span>
<span class="ne">---&gt; </span><span class="mi">58</span>     <span class="n">cosine_sim</span> <span class="o">=</span> <span class="n">linear_kernel</span><span class="p">(</span><span class="n">tfidf_matrix</span><span class="p">,</span> <span class="n">tfidf_matrix</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span> 
<span class="g g-Whitespace">     </span><span class="mi">60</span>     <span class="c1"># Creating an inverted index for easier calling of artist names</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\sklearn\metrics\pairwise.py</span> in <span class="ni">linear_kernel</span><span class="nt">(X, Y, dense_output)</span>
<span class="g g-Whitespace">   </span><span class="mi">1003</span>     <span class="s2">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1004</span><span class="s2">     X, Y = check_pairwise_arrays(X, Y)</span>
<span class="ne">-&gt; </span><span class="mi">1005</span><span class="s2">     return safe_sparse_dot(X, Y.T, dense_output=dense_output)</span>
<span class="g g-Whitespace">   </span><span class="mi">1006</span><span class="s2"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1007</span><span class="s2"> </span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\sklearn\utils\validation.py</span> in <span class="ni">inner_f</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span><span class="s2">             extra_args = len(args) - len(all_args)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span><span class="s2">             if extra_args &lt;= 0:</span>
<span class="ne">---&gt; </span><span class="mi">63</span><span class="s2">                 return f(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span><span class="s2"> </span>
<span class="g g-Whitespace">     </span><span class="mi">65</span><span class="s2">             # extra_args &gt; 0</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\sklearn\utils\extmath.py</span> in <span class="ni">safe_sparse_dot</span><span class="nt">(a, b, dense_output)</span>
<span class="g g-Whitespace">    </span><span class="mi">154</span><span class="s2">     if (sparse.issparse(a) and sparse.issparse(b)</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span><span class="s2">             and dense_output and hasattr(ret, &quot;toarray&quot;)):</span>
<span class="ne">--&gt; </span><span class="mi">156</span><span class="s2">         return ret.toarray()</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span><span class="s2">     return ret</span>
<span class="g g-Whitespace">    </span><span class="mi">158</span><span class="s2"> </span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\scipy\sparse\compressed.py</span> in <span class="ni">toarray</span><span class="nt">(self, order, out)</span>
<span class="g g-Whitespace">   </span><span class="mi">1029</span><span class="s2">         if out is None and order is None:</span>
<span class="g g-Whitespace">   </span><span class="mi">1030</span><span class="s2">             order = self._swap(&#39;cf&#39;)[0]</span>
<span class="ne">-&gt; </span><span class="mi">1031</span><span class="s2">         out = self._process_toarray_args(order, out)</span>
<span class="g g-Whitespace">   </span><span class="mi">1032</span><span class="s2">         if not (out.flags.c_contiguous or out.flags.f_contiguous):</span>
<span class="g g-Whitespace">   </span><span class="mi">1033</span><span class="s2">             raise ValueError(&#39;Output array must be C or F contiguous&#39;)</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\scipy\sparse\base.py</span> in <span class="ni">_process_toarray_args</span><span class="nt">(self, order, out)</span>
<span class="g g-Whitespace">   </span><span class="mi">1200</span><span class="s2">             return out</span>
<span class="g g-Whitespace">   </span><span class="mi">1201</span><span class="s2">         else:</span>
<span class="ne">-&gt; </span><span class="mi">1202</span><span class="s2">             return np.zeros(self.shape, dtype=self.dtype, order=order)</span>
<span class="g g-Whitespace">   </span><span class="mi">1203</span><span class="s2"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1204</span><span class="s2"> </span>

<span class="ne">MemoryError</span>: Unable to allocate 2.32 GiB for an array with shape (17632, 17632) and data type float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">content_based_recommendation_2</span><span class="p">(</span><span class="s1">&#39;Kanye West&#39;</span><span class="p">,</span> <span class="n">artists_tags</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">MemoryError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_42284</span><span class="o">/</span><span class="mf">3896620694.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">content_based_recommendation_2</span><span class="p">(</span><span class="s1">&#39;Kanye West&#39;</span><span class="p">,</span> <span class="n">artists_tags</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>

<span class="nn">~\CA4015\CA4015-Recommender-System\jupyter-book\content_based_recommender.py</span> in <span class="ni">content_based_recommendation_2</span><span class="nt">(artist_name, artist_tags_df, tags_df)</span>
<span class="g g-Whitespace">     </span><span class="mi">82</span> 
<span class="g g-Whitespace">     </span><span class="mi">83</span>     <span class="c1"># Defining the cosine similarity and storing in a matrix</span>
<span class="ne">---&gt; </span><span class="mi">84</span>     <span class="n">cosine_sim</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">count_matrix</span><span class="p">,</span> <span class="n">count_matrix</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">85</span> 
<span class="g g-Whitespace">     </span><span class="mi">86</span>     <span class="c1"># Creating an inverted index for easier calling of artist names</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\sklearn\metrics\pairwise.py</span> in <span class="ni">cosine_similarity</span><span class="nt">(X, Y, dense_output)</span>
<span class="g g-Whitespace">   </span><span class="mi">1186</span>         <span class="n">Y_normalized</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1187</span> 
<span class="ne">-&gt; </span><span class="mi">1188</span>     <span class="n">K</span> <span class="o">=</span> <span class="n">safe_sparse_dot</span><span class="p">(</span><span class="n">X_normalized</span><span class="p">,</span> <span class="n">Y_normalized</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1189</span>                         <span class="n">dense_output</span><span class="o">=</span><span class="n">dense_output</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1190</span> 

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\sklearn\utils\validation.py</span> in <span class="ni">inner_f</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span>             <span class="n">extra_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_args</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>             <span class="k">if</span> <span class="n">extra_args</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">63</span>                 <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span> 
<span class="g g-Whitespace">     </span><span class="mi">65</span>             <span class="c1"># extra_args &gt; 0</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\sklearn\utils\extmath.py</span> in <span class="ni">safe_sparse_dot</span><span class="nt">(a, b, dense_output)</span>
<span class="g g-Whitespace">    </span><span class="mi">154</span>     <span class="k">if</span> <span class="p">(</span><span class="n">sparse</span><span class="o">.</span><span class="n">issparse</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sparse</span><span class="o">.</span><span class="n">issparse</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span>             <span class="ow">and</span> <span class="n">dense_output</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="s2">&quot;toarray&quot;</span><span class="p">)):</span>
<span class="ne">--&gt; </span><span class="mi">156</span>         <span class="k">return</span> <span class="n">ret</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span>     <span class="k">return</span> <span class="n">ret</span>
<span class="g g-Whitespace">    </span><span class="mi">158</span> 

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\scipy\sparse\compressed.py</span> in <span class="ni">toarray</span><span class="nt">(self, order, out)</span>
<span class="g g-Whitespace">   </span><span class="mi">1029</span>         <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1030</span>             <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_swap</span><span class="p">(</span><span class="s1">&#39;cf&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="ne">-&gt; </span><span class="mi">1031</span>         <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_toarray_args</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1032</span>         <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">c_contiguous</span> <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">f_contiguous</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1033</span>             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Output array must be C or F contiguous&#39;</span><span class="p">)</span>

<span class="nn">~\AppData\Local\Continuum\anaconda3\envs\ca4015\lib\site-packages\scipy\sparse\base.py</span> in <span class="ni">_process_toarray_args</span><span class="nt">(self, order, out)</span>
<span class="g g-Whitespace">   </span><span class="mi">1200</span>             <span class="k">return</span> <span class="n">out</span>
<span class="g g-Whitespace">   </span><span class="mi">1201</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1202</span>             <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1203</span> 
<span class="g g-Whitespace">   </span><span class="mi">1204</span> 

<span class="ne">MemoryError</span>: Unable to allocate 2.32 GiB for an array with shape (17632, 17632) and data type float64
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Lara Murphy<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>